(function(b){var a=1;b.generateId=function(d){var c;do{c=(a++)+(d?"-"+d:"");}while(document.getElementById(c));return c;};})(jQuery);(function(a){a.executeCallback=function(c,b){if(typeof c=="function"){c.call(this,b);return true;}else{return false;}};})(jQuery);(function(a){a.getHashParam=function(b){var d=window.location.hash;if(d!=""){var e=(d.indexOf("&"+b+"=")>0)?d.indexOf("&"+b+"="):d.indexOf("#"+b+"=");if(e>=0){e+=b.length+2;var c=d.indexOf("&",e);if(c>e){return d.substring(e,c);}else{if(c<0){return d.substring(e);}}return"";}else{return false;}}else{return false;}};})(jQuery);(function(a){a.updateHashParam=function(c,e){var b=a.getHashParam(c);var f=window.location.hash;if(b!==e){if(typeof b=="string"){var h=(f.indexOf("&"+c+"=")>0)?f.indexOf("&"+c+"="):f.indexOf("#"+c+"=");var d=h+c.length+2+b.length;var g=(h==0)?"#":"&";window.location.hash=f.substring(0,h)+g+c+"="+e+f.substring(d);}else{if(f.length===0){window.location.hash="#"+c+"="+e;}else{window.location.hash+="&"+c+"="+e;}}}};})(jQuery);jQuery.fn.oneFingerScroll=function(){var c=0;var a;var b;$(this).bind("touchstart",function(d){var f=d.originalEvent;a=$(this).scrollTop()+f.touches[0].pageY;b=$(this).scrollLeft()+f.touches[0].pageX;f.preventDefault();});$(this).bind("touchmove",function(d){var f=d.originalEvent;$(this).scrollTop(a-f.touches[0].pageY);$(this).scrollLeft(b-f.touches[0].pageX);f.preventDefault();});return this;};(function(a){a.fn.dragscrollable=function(b){var d=a.extend({dragSelector:">:first",acceptPropagatedEvent:true,preventDefault:true},b||{});var c={mouseDownHandler:function(e){if(e.which!=1||(!e.data.acceptPropagatedEvent&&e.target!=this)){return false;}e.data.lastCoord={left:e.clientX,top:e.clientY};a.event.add(document,"mouseup",c.mouseUpHandler,e.data);a.event.add(document,"mousemove",c.mouseMoveHandler,e.data);if(e.data.preventDefault){e.preventDefault();return false;}},mouseMoveHandler:function(e){var f={left:(e.clientX-e.data.lastCoord.left),top:(e.clientY-e.data.lastCoord.top)};e.data.scrollable.scrollLeft(e.data.scrollable.scrollLeft()-f.left);e.data.scrollable.scrollTop(e.data.scrollable.scrollTop()-f.top);e.data.lastCoord={left:e.clientX,top:e.clientY};if(e.data.preventDefault){e.preventDefault();return false;}},mouseUpHandler:function(e){a.event.remove(document,"mousemove",c.mouseMoveHandler);a.event.remove(document,"mouseup",c.mouseUpHandler);if(e.data.preventDefault){e.preventDefault();return false;}}};this.each(function(){var e={scrollable:a(this),acceptPropagatedEvent:d.acceptPropagatedEvent,preventDefault:d.preventDefault};a(this).find(d.dragSelector).bind("mousedown",e,c.mouseDownHandler);});};})(jQuery);(function(d){var i,a;var e;var b;d.extend({pnotify_remove_all:function(){var k=e.data("pnotify");if(k&&k.length){d.each(k,function(){if(this.pnotify_remove){this.pnotify_remove();}});}},pnotify_position_all:function(){if(a){clearTimeout(a);}a=null;var k=e.data("pnotify");if(!k||!k.length){return;}d.each(k,function(){var o=this.opts.pnotify_stack;if(!o){return;}if(!o.nextpos1){o.nextpos1=o.firstpos1;}if(!o.nextpos2){o.nextpos2=o.firstpos2;}if(!o.addpos2){o.addpos2=0;}if(this.css("display")!="none"){var q,p;var l={};var n;switch(o.dir1){case"down":n="top";break;case"up":n="bottom";break;case"left":n="right";break;case"right":n="left";break;}q=parseInt(this.css(n),10);if(isNaN(q)){q=0;}if(typeof o.firstpos1=="undefined"){o.firstpos1=q;o.nextpos1=o.firstpos1;}var m;switch(o.dir2){case"down":m="top";break;case"up":m="bottom";break;case"left":m="right";break;case"right":m="left";break;}p=parseInt(this.css(m),10);if(isNaN(p)){p=0;}if(typeof o.firstpos2=="undefined"){o.firstpos2=p;o.nextpos2=o.firstpos2;}if((o.dir1=="down"&&o.nextpos1+this.height()>b.height())||(o.dir1=="up"&&o.nextpos1+this.height()>b.height())||(o.dir1=="left"&&o.nextpos1+this.width()>b.width())||(o.dir1=="right"&&o.nextpos1+this.width()>b.width())){o.nextpos1=o.firstpos1;o.nextpos2+=o.addpos2+10;o.addpos2=0;}if(o.animation&&o.nextpos2<p){switch(o.dir2){case"down":l.top=o.nextpos2+"px";break;case"up":l.bottom=o.nextpos2+"px";break;case"left":l.right=o.nextpos2+"px";break;case"right":l.left=o.nextpos2+"px";break;}}else{this.css(m,o.nextpos2+"px");}switch(o.dir2){case"down":case"up":if(this.outerHeight(true)>o.addpos2){o.addpos2=this.height();}break;case"left":case"right":if(this.outerWidth(true)>o.addpos2){o.addpos2=this.width();}break;}if(o.nextpos1){if(o.animation&&(q>o.nextpos1||l.top||l.bottom||l.right||l.left)){switch(o.dir1){case"down":l.top=o.nextpos1+"px";break;case"up":l.bottom=o.nextpos1+"px";break;case"left":l.right=o.nextpos1+"px";break;case"right":l.left=o.nextpos1+"px";break;}}else{this.css(n,o.nextpos1+"px");}}if(l.top||l.bottom||l.right||l.left){this.animate(l,{duration:500,queue:false});}switch(o.dir1){case"down":case"up":o.nextpos1+=this.height()+10;break;case"left":case"right":o.nextpos1+=this.width()+10;break;}}});d.each(k,function(){var l=this.opts.pnotify_stack;if(!l){return;}l.nextpos1=l.firstpos1;l.nextpos2=l.firstpos2;l.addpos2=0;l.animation=true;});},pnotify:function(r){if(!e){e=d("body");}if(!b){b=d(window);}var s;var k;if(typeof r!="object"){k=d.extend({},d.pnotify.defaults);k.pnotify_text=r;}else{k=d.extend({},d.pnotify.defaults,r);}if(k.pnotify_before_init){if(k.pnotify_before_init(k)===false){return null;}}var l;var m=function(x,u){o.css("display","none");var t=document.elementFromPoint(x.clientX,x.clientY);o.css("display","block");var w=d(t);var v=w.css("cursor");o.css("cursor",v!="auto"?v:"default");if(!l||l.get(0)!=t){if(l){f.call(l.get(0),"mouseleave",x.originalEvent);f.call(l.get(0),"mouseout",x.originalEvent);}f.call(t,"mouseenter",x.originalEvent);f.call(t,"mouseover",x.originalEvent);}f.call(t,u,x.originalEvent);l=w;};var o=d("<div />",{"class":"ui-pnotify "+k.pnotify_addclass,css:{display:"none"},mouseenter:function(t){if(k.pnotify_nonblock){t.stopPropagation();}if(k.pnotify_mouse_reset&&s=="out"){o.stop(true);s="in";o.css("height","auto").animate({width:k.pnotify_width,opacity:k.pnotify_nonblock?k.pnotify_nonblock_opacity:k.pnotify_opacity},"fast");}if(k.pnotify_nonblock){o.animate({opacity:k.pnotify_nonblock_opacity},"fast");}if(k.pnotify_hide&&k.pnotify_mouse_reset){o.pnotify_cancel_remove();}if(k.pnotify_closer&&!k.pnotify_nonblock){o.closer.show();}},mouseleave:function(t){if(k.pnotify_nonblock){t.stopPropagation();}l=null;o.css("cursor","auto");if(k.pnotify_nonblock&&s!="out"){o.animate({opacity:k.pnotify_opacity},"fast");}if(k.pnotify_hide&&k.pnotify_mouse_reset){o.pnotify_queue_remove();}o.closer.hide();d.pnotify_position_all();},mouseover:function(t){if(k.pnotify_nonblock){t.stopPropagation();}},mouseout:function(t){if(k.pnotify_nonblock){t.stopPropagation();}},mousemove:function(t){if(k.pnotify_nonblock){t.stopPropagation();m(t,"onmousemove");}},mousedown:function(t){if(k.pnotify_nonblock){t.stopPropagation();t.preventDefault();m(t,"onmousedown");}},mouseup:function(t){if(k.pnotify_nonblock){t.stopPropagation();t.preventDefault();m(t,"onmouseup");}},click:function(t){if(k.pnotify_nonblock){t.stopPropagation();m(t,"onclick");}},dblclick:function(t){if(k.pnotify_nonblock){t.stopPropagation();m(t,"ondblclick");}}});o.opts=k;if(k.pnotify_shadow&&!d.browser.msie){o.shadow_container=d("<div />",{"class":"ui-widget-shadow ui-corner-all ui-pnotify-shadow"}).prependTo(o);}o.container=d("<div />",{"class":"ui-widget ui-widget-content ui-corner-all ui-pnotify-container "+(k.pnotify_type=="error"?"ui-state-error":"ui-state-highlight")}).appendTo(o);o.pnotify_version="1.0.1";o.pnotify=function(t){var u=k;if(typeof t=="string"){k.pnotify_text=t;}else{k=d.extend({},k,t);}o.opts=k;if(k.pnotify_shadow!=u.pnotify_shadow){if(k.pnotify_shadow&&!d.browser.msie){o.shadow_container=d("<div />",{"class":"ui-widget-shadow ui-pnotify-shadow"}).prependTo(o);}else{o.children(".ui-pnotify-shadow").remove();}}if(k.pnotify_addclass===false){o.removeClass(u.pnotify_addclass);}else{if(k.pnotify_addclass!==u.pnotify_addclass){o.removeClass(u.pnotify_addclass).addClass(k.pnotify_addclass);}}if(k.pnotify_title===false){o.title_container.hide("fast");}else{if(k.pnotify_title!==u.pnotify_title){o.title_container.html(k.pnotify_title).show(200);}}if(k.pnotify_text===false){o.text_container.hide("fast");}else{if(k.pnotify_text!==u.pnotify_text){if(k.pnotify_insert_brs){k.pnotify_text=k.pnotify_text.replace(/\n/g,"<br />");}o.text_container.html(k.pnotify_text).show(200);}}o.pnotify_history=k.pnotify_history;if(k.pnotify_type!=u.pnotify_type){o.container.toggleClass("ui-state-error ui-state-highlight");}if((k.pnotify_notice_icon!=u.pnotify_notice_icon&&k.pnotify_type=="notice")||(k.pnotify_error_icon!=u.pnotify_error_icon&&k.pnotify_type=="error")||(k.pnotify_type!=u.pnotify_type)){o.container.find("div.ui-pnotify-icon").remove();if((k.pnotify_error_icon&&k.pnotify_type=="error")||(k.pnotify_notice_icon)){d("<div />",{"class":"ui-pnotify-icon"}).append(d("<span />",{"class":k.pnotify_type=="error"?k.pnotify_error_icon:k.pnotify_notice_icon})).prependTo(o.container);}}if(k.pnotify_width!==u.pnotify_width){o.animate({width:k.pnotify_width});}if(k.pnotify_min_height!==u.pnotify_min_height){o.container.animate({minHeight:k.pnotify_min_height});}if(k.pnotify_opacity!==u.pnotify_opacity){o.fadeTo(k.pnotify_animate_speed,k.pnotify_opacity);}if(!k.pnotify_hide){o.pnotify_cancel_remove();}else{if(!u.pnotify_hide){o.pnotify_queue_remove();}}o.pnotify_queue_position();return o;};o.pnotify_queue_position=function(){if(a){clearTimeout(a);}a=setTimeout(d.pnotify_position_all,10);};o.pnotify_display=function(){if(!o.parent().length){o.appendTo(e);}if(k.pnotify_before_open){if(k.pnotify_before_open(o)===false){return;}}o.pnotify_queue_position();if(k.pnotify_animation=="fade"||k.pnotify_animation.effect_in=="fade"){o.show().fadeTo(0,0).hide();}else{if(k.pnotify_opacity!=1){o.show().fadeTo(0,k.pnotify_opacity).hide();}}o.animate_in(function(){if(k.pnotify_after_open){k.pnotify_after_open(o);}o.pnotify_queue_position();if(k.pnotify_hide){o.pnotify_queue_remove();}});};o.pnotify_remove=function(){if(o.timer){window.clearTimeout(o.timer);o.timer=null;}if(k.pnotify_before_close){if(k.pnotify_before_close(o)===false){return;}}o.animate_out(function(){if(k.pnotify_after_close){if(k.pnotify_after_close(o)===false){return;}}o.pnotify_queue_position();if(k.pnotify_remove){o.detach();}});};o.animate_in=function(u){s="in";var t;if(typeof k.pnotify_animation.effect_in!="undefined"){t=k.pnotify_animation.effect_in;}else{t=k.pnotify_animation;}if(t=="none"){o.show();u();}else{if(t=="show"){o.show(k.pnotify_animate_speed,u);}else{if(t=="fade"){o.show().fadeTo(k.pnotify_animate_speed,k.pnotify_opacity,u);}else{if(t=="slide"){o.slideDown(k.pnotify_animate_speed,u);}else{if(typeof t=="function"){t("in",u,o);}else{if(o.effect){o.effect(t,{},k.pnotify_animate_speed,u);}}}}}}};o.animate_out=function(u){s="out";var t;if(typeof k.pnotify_animation.effect_out!="undefined"){t=k.pnotify_animation.effect_out;}else{t=k.pnotify_animation;}if(t=="none"){o.hide();u();}else{if(t=="show"){o.hide(k.pnotify_animate_speed,u);}else{if(t=="fade"){o.fadeOut(k.pnotify_animate_speed,u);}else{if(t=="slide"){o.slideUp(k.pnotify_animate_speed,u);}else{if(typeof t=="function"){t("out",u,o);}else{if(o.effect){o.effect(t,{},k.pnotify_animate_speed,u);}}}}}}};o.pnotify_cancel_remove=function(){if(o.timer){window.clearTimeout(o.timer);}};o.pnotify_queue_remove=function(){o.pnotify_cancel_remove();o.timer=window.setTimeout(function(){o.pnotify_remove();},(isNaN(k.pnotify_delay)?0:k.pnotify_delay));};o.closer=d("<div />",{"class":"ui-pnotify-closer",css:{cursor:"pointer",display:"none"},click:function(){o.pnotify_remove();o.closer.hide();}}).append(d("<span />",{"class":"ui-icon ui-icon-circle-close"})).appendTo(o.container);if((k.pnotify_error_icon&&k.pnotify_type=="error")||(k.pnotify_notice_icon)){d("<div />",{"class":"ui-pnotify-icon"}).append(d("<span />",{"class":k.pnotify_type=="error"?k.pnotify_error_icon:k.pnotify_notice_icon})).appendTo(o.container);}o.title_container=d("<div />",{"class":"ui-pnotify-title",html:k.pnotify_title}).appendTo(o.container);if(k.pnotify_title===false){o.title_container.hide();}if(k.pnotify_insert_brs&&typeof k.pnotify_text=="string"){k.pnotify_text=k.pnotify_text.replace(/\n/g,"<br />");}o.text_container=d("<div />",{"class":"ui-pnotify-text",html:k.pnotify_text}).appendTo(o.container);if(k.pnotify_text===false){o.text_container.hide();}if(typeof k.pnotify_width=="string"){o.css("width",k.pnotify_width);}if(typeof k.pnotify_min_height=="string"){o.container.css("min-height",k.pnotify_min_height);}o.pnotify_history=k.pnotify_history;var q=e.data("pnotify");if(q==null||typeof q!="object"){q=[];}if(k.pnotify_stack.push=="top"){q=d.merge([o],q);}else{q=d.merge(q,[o]);}e.data("pnotify",q);if(k.pnotify_after_init){k.pnotify_after_init(o);}if(k.pnotify_history){var p=e.data("pnotify_history");if(typeof p=="undefined"){p=d("<div />",{"class":"ui-pnotify-history-container ui-state-default ui-corner-bottom",mouseleave:function(){p.animate({top:"-"+i+"px"},{duration:100,queue:false});}}).append(d("<div />",{"class":"ui-pnotify-history-header",text:"Redisplay"})).append(d("<button />",{"class":"ui-pnotify-history-all ui-state-default ui-corner-all",text:"All",mouseenter:function(){d(this).addClass("ui-state-hover");},mouseleave:function(){d(this).removeClass("ui-state-hover");},click:function(){d.each(q,function(){if(this.pnotify_history&&this.pnotify_display){this.pnotify_display();}});return false;}})).append(d("<button />",{"class":"ui-pnotify-history-last ui-state-default ui-corner-all",text:"Last",mouseenter:function(){d(this).addClass("ui-state-hover");},mouseleave:function(){d(this).removeClass("ui-state-hover");},click:function(){var t=1;while(!q[q.length-t]||!q[q.length-t].pnotify_history||q[q.length-t].is(":visible")){if(q.length-t===0){return false;}t++;}var u=q[q.length-t];if(u.pnotify_display){u.pnotify_display();}return false;}})).appendTo(e);var n=d("<span />",{"class":"ui-pnotify-history-pulldown ui-icon ui-icon-grip-dotted-horizontal",mouseenter:function(){p.animate({top:"0"},{duration:100,queue:false});}}).appendTo(p);i=n.offset().top+2;p.css({top:"-"+i+"px"});e.data("pnotify_history",p);}}k.pnotify_stack.animation=false;o.pnotify_display();return o;}});var j=/^on/;var c=/^(dbl)?click$|^mouse(move|down|up|over|out|enter|leave)$|^contextmenu$/;var h=/^(focus|blur|select|change|reset)$|^key(press|down|up)$/;var g=/^(scroll|resize|(un)?load|abort|error)$/;var f=function(l,k){var m;l=l.toLowerCase();if(document.createEvent&&this.dispatchEvent){l=l.replace(j,"");if(l.match(c)){d(this).offset();m=document.createEvent("MouseEvents");m.initMouseEvent(l,k.bubbles,k.cancelable,k.view,k.detail,k.screenX,k.screenY,k.clientX,k.clientY,k.ctrlKey,k.altKey,k.shiftKey,k.metaKey,k.button,k.relatedTarget);}else{if(l.match(h)){m=document.createEvent("UIEvents");m.initUIEvent(l,k.bubbles,k.cancelable,k.view,k.detail);}else{if(l.match(g)){m=document.createEvent("HTMLEvents");m.initEvent(l,k.bubbles,k.cancelable);}}}if(!m){return;}this.dispatchEvent(m);}else{if(!l.match(j)){l="on"+l;}m=document.createEventObject(k);this.fireEvent(l,m);}};d.pnotify.defaults={pnotify_title:false,pnotify_text:false,pnotify_addclass:"",pnotify_nonblock:false,pnotify_nonblock_opacity:0.2,pnotify_history:true,pnotify_width:"300px",pnotify_min_height:"16px",pnotify_type:"notice",pnotify_notice_icon:"ui-icon ui-icon-info",pnotify_error_icon:"ui-icon ui-icon-alert",pnotify_animation:"fade",pnotify_animate_speed:"slow",pnotify_opacity:1,pnotify_shadow:false,pnotify_closer:true,pnotify_hide:true,pnotify_delay:8000,pnotify_mouse_reset:true,pnotify_remove:true,pnotify_insert_brs:true,pnotify_stack:{dir1:"down",dir2:"left",push:"bottom"}};})(jQuery);(function(a){var b=function(p,y){var G={adaptivePadding:0.05,backendServer:"",enableAutoTitle:true,enableFullscreen:true,enableGotoPage:true,enableGrid:true,enableKeyScroll:true,enableSpaceScroll:false,enableZoomSlider:true,fixedPadding:10,iipServerBaseUrl:"",maxZoomLevel:0,minZoomLevel:0,onFullscreen:null,onFullscreenEnter:null,onFullscreenExit:null,onJump:null,onReady:null,onScroll:null,onScrollDown:null,onScrollUp:null,onZoom:null,onZoomIn:null,onZoomOut:null,pagesPerGridRow:5,tileFadeSpeed:300,tileHeight:256,tileWidth:256,viewportMargin:200,zoomLevel:2};var ac=a.extend({},G,y);var l={centerX:0,centerY:0,currentPageIndex:0,dimAfterZoom:0,dimBeforeZoom:0,doubleClick:false,elementSelector:"",firstAjaxRequest:true,firstPageLoaded:-1,firstRowLoaded:-1,fullscreenStatusbar:null,goDirectlyTo:0,heightAbovePages:[],horizontalOffset:0,horizontalPadding:0,ID:null,inFullscreen:false,inGrid:false,itemTitle:"",lastPageLoaded:-1,lastRowLoaded:-1,maxHeight:0,maxWidth:0,mobileSafari:false,numPages:0,numRows:0,pages:[],panelHeight:0,panelWidth:0,prevVptTop:0,scaleWait:false,selector:"",scrollSoFar:0,totalHeight:0,verticalOffset:0,verticalPadding:0,viewerXOffset:0,viewerYOffset:0,zoomInCallback:null,zoomOutCallback:null};a.extend(ac,l);var M=function(ak,ah){var ai=ac.panelHeight;var ag=ac.scrollSoFar-ac.viewportMargin;var aj=ag+ai+ac.viewportMargin*2;if(ak>=ag&&ak<=aj){return true;}else{if(ah>=ag&&ah<=aj){return true;}else{if(ak<=ag&&ah>=aj){return true;}else{return false;}}}};var k=function(ag){if(a(ac.selector+"page-"+ag).length===0){return false;}else{return true;}};var X=function(ag){var ah=ac.heightAbovePages[ag];var ai=ah+ac.pages[ag].h+ac.verticalPadding;return M(ah,ai);};var r=function(ag,ai,ak){var ah=ac.heightAbovePages[ag]+(ai*ac.tileHeight)+ac.verticalPadding;var aj=ah+ac.tileHeight;return M(ah,aj);};var P=function(ag,ah){if(a(ac.selector+"tile-"+ag+"-"+ah).length>0){return true;}else{return false;}};var s=function(aw){var aB=[];var aC=ac.pages[aw].fn;var ar=ac.pages[aw].r;var au=ac.pages[aw].c;var aA=ac.pages[aw].w;var ax=ac.pages[aw].h;var az=ac.pages[aw].m_z;var at,am;var aE,ai,ao,an,ap,ag,ah;var aG=0;var ak=ac.heightAbovePages[aw]+ac.verticalPadding;if(!k(aw)){aB.push('<div id="'+ac.ID+"page-"+aw+'" style="top: '+ak+"px; width: "+aA+"px; height: "+ax+"px; left: 50%; margin-left: -"+(aA/2)+'px" class="diva-page">');}aE=ax-(ar-1)*ac.tileHeight;ai=aA-(au-1)*ac.tileWidth;var aF=[];for(ao=0;ao<ar;ao++){for(an=0;an<au;an++){var av=ao*ac.tileHeight;var al=an*ac.tileWidth;var aq=(ac.tileFadeSpeed)?"none":"inline";var ay=(az===ac.maxZoomLevel)?ac.zoomLevel:ac.zoomLevel+(az-ac.maxZoomLevel);ap=(ao===ar-1)?aE:ac.tileHeight;ag=(an===au-1)?ai:ac.tileWidth;ah=ac.iipServerBaseUrl+aC+"&amp;JTL="+ay+","+aG;if(!P(aw,aG)&&r(aw,ao,an)){aB.push('<div id="'+ac.ID+"tile-"+aw+"-"+aG+'"style="display: '+aq+"; position: absolute; top: "+av+"px; left: "+al+"px; background-image: url('"+ah+"'); height: "+ap+"px; width: "+ag+'px;"></div>');}aF.push(aG);aG++;}}if(!k(aw)){aB.push("</div>");var aj=aB.join("");a(ac.innerSelector).append(aj);}else{a(ac.selector+"page-"+aw).append(aB.join(""));}if(ac.tileFadeSpeed){for(var aD=0;aD<aF.length;aD++){a(ac.selector+"tile-"+aw+"-"+aF[aD]).fadeIn(ac.tileFadeSpeed);}}};var H=function(ag){if(k(ag)){a(ac.selector+"page-"+ag).remove();}};var n=function(ag){if(ag>=0&&ag<ac.numRows){return true;}else{return false;}};var R=function(ag){if(ag>=0&&ag<ac.numPages){return true;}else{return false;}};var T=function(ah){var ai=ac.heightAbovePages[ah]+ac.pages[ah].h+ac.verticalPadding;var ag=ac.scrollSoFar;if(ai<ag){return true;}else{return false;}};var d=function(ag){var ah=ac.heightAbovePages[ag];var ai=ac.scrollSoFar+ac.panelHeight;if(ah>ai){return true;}else{return false;}};var Z=function(ai){var ah=ac.rowHeight*(ai+1);var ag=ac.scrollSoFar;if(ah<ag){return true;}else{return false;}};var g=function(ai){var ag=ac.rowHeight*ai;var ah=ac.scrollSoFar+ac.panelHeight;if(ag>ah){return true;}else{return false;}};var O=function(ag){var ah=ag+1;a.updateHashParam("p",""+ah);a(ac.selector+"current span").text(ah);if(ac.inFullscreen){if(ac.fullscreenStatusbar===null){h("fade");}ac.fullscreenStatusbar.pnotify({pnotify_title:"Page: "+ah});}};var v=function(ak){var ai=ac.currentPageIndex;var ag=ac.currentPageIndex+parseInt(ak,10);var aj=ac.scrollSoFar+(ac.panelHeight/2);var ah=false;if(ak<0){if(ag>=0&&(ac.heightAbovePages[ai]>=aj||ac.heightAbovePages[ag]>=ac.scrollSoFar)){ah=true;}}else{if(ak>0){if(ac.heightAbovePages[ai]+ac.pages[ai].h<ac.scrollSoFar&&ag<ac.pages.length){ah=true;}}}if(ah){ac.currentPageIndex=ag;if(ak!==0){if(!v(ak)){O(ag);}}return true;}else{return false;}};var A=function(ag,ah){if(ah>0){if(R(ag)){if(X(ag)){s(ag);ac.lastPageLoaded=ag;A(ac.lastPageLoaded+1,ah);}else{if(T(ag)){A(ag+1,ah);}}}else{return;}}else{if(R(ag)){if(X(ag)){s(ag);ac.firstPageLoaded=ag;A(ac.firstPageLoaded-1,ah);}else{if(d(ag)){A(ag-1,ah);}}}else{return;}}};var I=function(ag,ah){if(ah>0){if(R(ag)&&T(ag)){H(ag);ac.firstPageLoaded++;I(ac.firstPageLoaded,ah);}else{return;}}else{if(R(ag)&&d(ag)){H(ag);ac.lastPageLoaded--;I(ac.lastPageLoaded,ah);}else{return;}}};var C=function(ah,ag){if(ag>0){if(n(ah)){if(V(ah)){j(ah);ac.lastRowLoaded=ah;C(ac.lastRowLoaded+1,ag);}else{if(Z(ah)){C(ah+1,ag);}}}}else{if(n(ah)){if(V(ah)){j(ah);ac.firstRowLoaded=ah;C(ac.firstRowLoaded-1,ag);}else{if(g(ah)){C(ah-1,ag);}}}}};var F=function(ag){if(L(ag)){a(ac.selector+"row-"+ag).remove();}};var N=function(ah,ag){if(ag>0){if(n(ah)&&Z(ah)){F(ah);ac.firstRowLoaded++;N(ac.firstRowLoaded,ag);}}else{if(n(ah)&&g(ah)){F(ah);ac.lastRowLoaded--;N(ac.lastRowLoaded,ag);}}};var J=function(ag){if(ag<0){C(ac.firstRowLoaded,-1);N(ac.lastRowLoaded,-1);}else{if(ag>0){N(ac.firstRowLoaded,1);C(ac.lastRowLoaded,1);}}};var u=function(ag){if(ag<0){A(ac.firstPageLoaded,ag);v(-1);I(ac.lastPageLoaded,ag);}else{if(ag>0){I(ac.firstPageLoaded,ag);A(ac.lastPageLoaded,ag);v(1);}}if(ag!==0){a.executeCallback(ac.onScroll,ac.currentPageIndex);if(ag>0){a.executeCallback(ac.onScrollDown,ac.currentPageIndex);}else{a.executeCallback(ac.onScrollUp,ac.currentPageIndex);}}};var ad=function(){if(ac.goDirectlyTo){S(ac.goDirectlyTo);O(ac.goDirectlyTo-1);ac.goDirectlyTo=0;return;}var ak,aj,ai,ag;var ah=(ac.dimBeforeZoom>0)?ac.dimAfterZoom/ac.dimBeforeZoom:1;if(ac.doubleClick){ak=ac.centerX*ah;aj=ac.centerY*ah;ai=Math.max((ak)-(ac.panelWidth/2),0);ag=Math.max((aj)-(ac.panelHeight/2),0);}else{ai=ac.maxWidth/2-ac.panelWidth/2+ac.horizontalPadding;ag=ac.verticalOffset*ah;}ac.prevVptTop=0;a(ac.outerSelector).scrollTop(ag);a(ac.outerSelector).scrollLeft(ai);};var i=function(ah,ag){a.ajax({url:ac.backendServer+="&z="+ah,cache:true,context:this,dataType:"json",success:function(ai){if(ac.firstAjaxRequest){m(ai,ah);}c();ac.pages=ai.pgs;ac.maxWidth=ai.dims.max_w;ac.maxHeight=ai.dims.max_h;a.executeCallback(ag,ai);ac.firstAjaxRequest=false;}});};var m=function(ag,ah){ac.itemTitle=ag.item_title;ac.numPages=ag.pgs.length;ac.maxZoomLevel=(ac.maxZoomLevel>0&&ac.maxZoomLevel<=ag.max_zoom)?ac.maxZoomLevel:ag.max_zoom;if(ah>ac.maxZoomLevel){ah=0;}a(ac.selector+"current label").text(ac.numPages);if(ac.enableZoomSlider){K();}if(ac.enableAutoTitle){a(ac.elementSelector).prepend('<div id="'+ac.ID+'title">'+ac.itemTitle+"</div>");}};var L=function(ag){if(a(ac.selector+"row-"+ag).length>0){return true;}else{return false;}};var V=function(ai){var ah=ac.rowHeight*ai;var ag=ah+ac.rowHeight+ac.fixedPadding;return M(ah,ag);};var j=function(am){if(L(am)){return;}var al;var ag=(ac.rowHeight)*am+ac.fixedPadding;var aj=[];aj.push('<div id="'+ac.ID+"row-"+am+'" style="width: 100%; height: '+ac.rowHeight+"; position: absolute; top: "+ag+'px;">');for(al=0;al<ac.pagesPerGridRow;al++){var ak=am*ac.pagesPerGridRow+al;if(!R(ak)){break;}var an=ak+1;var ah=ac.pages[ak].fn;var ao=ac.iipServerBaseUrl+ah+"&amp;WID="+ac.gridPageWidth+"&amp;CVT=JPG";var ai=al*(ac.fixedPadding+ac.gridPageWidth)+ac.fixedPadding;aj.push('<div id="'+ac.ID+"page-"+ak+'" style="position: absolute; left: '+ai+"px; display: inline; background-image: url('"+ao+"'); background-repeat: no-repeat; width: "+ac.gridPageWidth+"px; height: "+ac.rowHeight+'px;"></div>');}a(ac.innerSelector).append(aj.join(""));};var f=function(){i(0,function(ai){var aj=ac.fixedPadding*(ac.pagesPerGridRow+1);var ag=(ac.panelWidth-aj)/ac.pagesPerGridRow;ac.gridPageWidth=ag;ac.rowHeight=ac.fixedPadding+ai.dims.max_ratio*ag;ac.numRows=Math.ceil(ac.numPages/ac.pagesPerGridRow);ac.totalHeight=ac.numRows*ac.rowHeight+ac.fixedPadding;a(ac.innerSelector).css("height",Math.round(ac.totalHeight));a(ac.innerSelector).css("width",Math.round(ac.panelWidth));S(ac.currentPageIndex+1);ac.scrollSoFar=a(ac.outerSelector).scrollTop();for(var ah=0;ah<ac.numPages;ah+=ac.pagesPerGridRow){var ak=Math.floor(ah/ac.pagesPerGridRow);if(V(ak)){ac.firstRowLoaded=(ac.firstRowLoaded<0)?ak:ac.firstRowLoaded;j(ak);ac.lastRowLoaded=ak;}}});};var c=function(){a(ac.outerSelector).scrollTop(0);ac.scrollSoFar=0;a(ac.innerSelector).text("");ac.firstPageLoaded=0;};var af=function(ag){i(ag,function(ak){if(ac.adaptivePadding>0){ac.horizontalPadding=ak.dims.a_wid*ac.adaptivePadding;ac.verticalPadding=ak.dims.a_hei*ac.adaptivePadding;}else{ac.horizontalPadding=ac.fixedPadding;ac.verticalPadding=ac.fixedPadding;}ac.totalHeight=ak.dims.t_hei+ac.verticalPadding*(ac.numPages+1);ac.zoomLevel=ag;ac.dimAfterZoom=ac.totalHeight;var ah=0;for(var ai=0;ai<ac.numPages;ai++){ac.heightAbovePages[ai]=ah;ah=ac.heightAbovePages[ai]+ac.pages[ai].h+ac.verticalPadding;if(X(ai)){s(ai);ac.lastPageLoaded=ai;}}a(ac.innerSelector).css("height",Math.round(ac.totalHeight));var aj=(ak.dims.max_w+ac.horizontalPadding*2<ac.panelWidth)?ac.panelWidth:ak.dims.max_w+ac.horizontalPadding*2;a(ac.innerSelector).css("width",Math.round(aj));ad();if(!ac.firstAjaxRequest){if(ac.dimBeforeZoom!==ac.dimAfterZoom){a.executeCallback(ac.onZoom,ag);if(ac.dimBeforeZoom>ac.dimAfterZoom){a.executeCallback(ac.onZoomOut,ag);a.executeCallback(ac.zoomOutCallback,ag);ac.zoomOutCallback=null;}else{a.executeCallback(ac.onZoomIn,ag);a.executeCallback(ac.zoomInCallback,ag);ac.zoomInCallback=null;}}else{a.executeCallback(ac.onFullscreen,ag);}}else{a.executeCallback(ac.onReady);}ac.dimBeforeZoom=ac.dimAfterZoom;if(ac.scaleWait){ac.scaleWait=false;}});};var Y=function(){ac.scrollSoFar=a(ac.outerSelector).scrollTop();u(ac.scrollSoFar-ac.prevVptTop);ac.prevVptTop=ac.scrollSoFar;};var ae=function(){ac.scrollSoFar=a(ac.outerSelector).scrollTop();J(ac.scrollSoFar-ac.prevVptTop);ac.prevVptTop=ac.scrollSoFar;};var B=function(ag){if(ac.zoomLevel!=ag&&ag>=ac.minZoomLevel&&ag<=ac.maxZoomLevel){af(ag);a(ac.selector+"zoom-slider").slider({value:ag});a.updateHashParam("z",""+ag);return true;}else{a.executeCallback(ac.zoomInCallback,ac.zoomLevel);a.executeCallback(ac.zoomOutCallback,ac.zoomLevel);ac.zoomOutCallback=null;ac.zoomInCallback=null;return false;}};var W=function(ag){ac.verticalOffset=a(ac.outerSelector).scrollTop();ac.horizontalOffset=a(ac.outerSelector).scrollLeft();if(ac.inGrid){e(true);}ac.doubleClick=false;B(ag);};var S=function(ag){if(ac.inGrid){var aj=Math.ceil(ag/ac.pagesPerGridRow)-1;if(n(aj)){var ai=aj*ac.rowHeight;a(ac.outerSelector).scrollTop(ai);O(ag-1);ac.currentPageIndex=ag-1;return true;}}else{pageIndex=ag-1;if(R(pageIndex)){var ai=ac.heightAbovePages[pageIndex];O(pageIndex);a(ac.outerSelector).scrollTop(ai);var ah=(a(ac.innerSelector).width()-ac.panelWidth)/2;a(ac.outerSelector).scrollLeft(ah);a.executeCallback(ac.onJump,ag);return true;}}return false;};var D=function(ah){var ag;if(ac.zoomLevel===ac.maxZoomLevel){if(ah.ctrlKey){ag=ac.zoomLevel-1;}else{return;}}else{if(ac.zoomLevel===ac.minZoomLevel){if(ah.ctrlKey){return;}else{ag=ac.zoomLevel+1;}}else{if(ah.ctrlKey){ag=ac.zoomLevel-1;}else{ag=ac.zoomLevel+1;}}}ac.centerX=(ah.pageX-ac.viewerXOffset)+a(ac.outerSelector).scrollLeft();ac.centerY=(ah.pageY-ac.viewerYOffset)+a(ac.outerSelector).scrollTop();ac.doubleClick=true;B(ag);};var x=function(ag){ag.preventDefault();};var E=function(ah){var ag=ac.zoomLevel;if(ah.scale>1&&ag<ac.maxZoomLevel){ag++;}else{if(ah.scale<1&&ag>ac.minZoomLevel){ag--;}else{return;}}ac.scaleWait=true;W(ag);};var q=function(){ac.verticalOffset=a(ac.outerSelector).scrollTop();ac.horizontalOffset=a(ac.outerSelector).scrollLeft();ac.doubleClick=false;a(ac.innerSelector).text("");if(ac.inFullscreen){Q();a.updateHashParam("fullscreen","false");}else{aa();a.updateHashParam("fullscreen","true");}ac.panelWidth=parseInt(a(ac.outerSelector).width(),10)-20;ac.panelHeight=parseInt(a(ac.outerSelector).height(),10);a(ac.innerSelector).width(ac.panelWidth);if(ac.inGrid){f();}else{af(ac.zoomLevel);}};var aa=function(){if(ac.fullscreenStatusbar==null){h("none");}a(ac.selector+"fullscreen").css("position","fixed").css("z-index","9001");a(ac.outerSelector).addClass("fullscreen");ac.inFullscreen=true;a("body").css("overflow","hidden");a.executeCallback(ac.onFullscreenEnter);};var Q=function(){if(ac.fullscreenStatusbar!=null){ac.fullscreenStatusbar.pnotify({pnotify_animation:"none"});ac.fullscreenStatusbar.pnotify_remove();ac.fullscreenStatusbar=null;}a(ac.outerSelector).removeClass("fullscreen");ac.inFullscreen=false;a(ac.selector+"fullscreen").css("position","absolute").css("z-index","8999");a.executeCallback(ac.onFullscreenExit);};var t=function(){if(ac.inGrid){e();}else{w();}};var w=function(){ac.inGrid=true;f();a.updateHashParam("grid","true");};var e=function(ag){ac.inGrid=false;if(!ac.goDirectlyTo){ac.goDirectlyTo=ac.currentPageIndex+1;}if(!ag){af(ac.zoomLevel);}a.updateHashParam("grid","false");};var z=function(){if(ac.enableGrid){a(ac.selector+"grid-icon").click(function(){t();});}if(ac.enableFullscreen){a(ac.selector+"fullscreen").click(function(){q();});var ah;a(window).resize(function(){clearTimeout(ah);ah=setTimeout(function(){ac.panelHeight=parseInt(a(ac.outerSelector).height(),10);u(1);var al=a("body").css("width");a(ac.innerSelector).css("width",al);},10);});}a(ac.innerSelector).mouseover(function(){a(this).removeClass("grabbing").addClass("grab");});a(ac.innerSelector).mouseout(function(){a(this).removeClass("grab");});a(ac.innerSelector).mousedown(function(){a(this).removeClass("grab").addClass("grabbing");});a(ac.innerSelector).mouseup(function(){a(this).removeClass("grabbing").addClass("grab");});a(ac.outerSelector+", "+ac.innerSelector).dragscrollable({dragSelector:".dragger",acceptPropagatedEvent:true});a(ac.outerSelector).scroll(function(){if(ac.inGrid){ae();}else{Y();}});a(ac.outerSelector).dblclick(function(an){ac.viewerXOffset=this.offsetLeft;ac.viewerYOffset=this.offsetTop;if(ac.inGrid){var ap=(an.pageX-ac.viewerXOffset)+a(ac.outerSelector).scrollLeft();var ao=(an.pageY-ac.viewerYOffset)+a(ac.outerSelector).scrollTop();var aq=Math.floor(ao/ac.rowHeight);var am=Math.floor(ap/(ac.panelWidth/ac.pagesPerGridRow));var al=aq*ac.pagesPerGridRow+am+1;ac.goDirectlyTo=al;e();}else{D(an);}});a(ac.outerSelector).bind("contextmenu",function(al){var am=al.originalEvent;if(am.ctrlKey){am.preventDefault();am.stopPropagation();}});if(ac.mobileSafari){a(ac.outerSelector).oneFingerScroll();var ai=[];ai.push('<meta name="viewport" content="user-scalable=no, width=device-width" />');ai.push('<meta name="apple-mobile-web-app-capable" content="yes" />');ai.push('<meta name="apple-mobile-web-app-status-bar-style" content="black" />');a("head").append(ai.join("\n"));a("body").bind("touchmove",function(al){var am=al.originalEvent;x(am);});a("body").bind("gestureend",function(al){var am=al.originalEvent;if(!ac.scaleWait){if(ac.inGrid){e();}else{E(am);}}return false;});}if(ac.enableSpaceScroll||ac.enableKeyScroll){var aj=a.ui.keyCode.SPACE;var ag=a.ui.keyCode.PAGE_UP;var ak=a.ui.keyCode.PAGE_DOWN;a(document).keydown(function(al){if((ac.enableSpaceScroll&&al.keyCode==aj)||(ac.enableKeyScroll&&al.keyCode==ak)){a(ac.outerSelector).scrollTop(ac.scrollSoFar+ac.panelHeight);return false;}if(ac.enableKeyScroll&&al.keyCode==ag){a(ac.outerSelector).scrollTop(ac.scrollSoFar-ac.panelHeight);return false;}});}};var h=function(ah){var ag={pnotify_text:'<form id="'+ac.ID+'goto-page-fullscreen"><input placeholder="'+ac.numPages+'" type="text" size="4" id="'+ac.ID+'goto-input-fullscreen" /><input type="submit" value="Go"></form>',pnotify_title:"Page: "+(ac.currentPageIndex+1),pnotify_history:false,pnotify_width:"110px",pnotify_hide:false,pnotify_notice_icon:"",pnotify_animation:ah,pnotify_before_close:function(){ac.fullscreenStatusbar=null;}};ac.fullscreenStatusbar=a.pnotify(ag);a(ac.selector+"goto-page-fullscreen").submit(function(){var ai=parseInt(a(ac.selector+"goto-input-fullscreen").val(),10);if(!S(ai)){alert("Invalid page number");}return false;});};var K=function(){a(ac.selector+"tools").prepend('<div id="'+ac.ID+'zoom-slider"></div>');a(ac.selector+"zoom-slider").slider({value:ac.zoomLevel,min:ac.minZoomLevel,max:ac.maxZoomLevel,step:1,slide:function(ag,ah){W(ah.value);}});};var U=function(){a(ac.selector+"tools").prepend('<div id="'+ac.ID+'grid-icon"></div>');};var o=function(){a(ac.selector+"tools").append('<form id="'+ac.ID+'goto-page">Go to page <input type="text" size="3" id="'+ac.ID+'goto-input" /> <input type="submit" value="Go" /><br /><div id="'+ac.ID+'current">Current page: <span>1</span> of <label></label></div></form>');a(ac.selector+"goto-page").submit(function(){var ag=parseInt(a(ac.selector+"goto-input").val(),10);if(!S(ag)){alert("Invalid page number");}return false;});};var ab=function(){ac.mobileSafari=navigator.platform=="iPad"||navigator.platform=="iPhone"||navigator.platform=="iPod";ac.elementSelector="#"+a(p).attr("id");ac.ID=a.generateId("diva-");ac.selector="#"+ac.ID;ac.outerSelector=ac.selector+"outer";ac.innerSelector=ac.selector+"inner";if(ac.zoomSlider||ac.enableGotoPage||ac.enableGrid){a(ac.elementSelector).prepend('<div id="'+ac.ID+'tools"></div>');}if(ac.enableGotoPage){o();}if(ac.enableGrid){U();}a(ac.elementSelector).append('<div id="'+ac.ID+'outer"></div>');a(ac.outerSelector).append('<div id="'+ac.ID+'inner" class="dragger"></div>');if(ac.mobileSafari){ac.panelWidth=screen.width-20;if(navigator.platform=="iPad"){ac.panelHeight=screen.height-170;}else{ac.panelHeight=screen.height-250;}a(ac.elementSelector).css("width",ac.panelWidth);a(ac.outerSelector).css("width",ac.panelWidth+"px");a(ac.outerSelector).css("height",ac.panelHeight+"px");}else{ac.panelWidth=parseInt(a(ac.elementSelector).width(),10)-18;a(ac.outerSelector).css("width",(ac.panelWidth+18)+"px");ac.panelHeight=parseInt(a(ac.outerSelector).height(),10);}if(ac.enableFullscreen){a(ac.elementSelector).prepend('<div id="'+ac.ID+'fullscreen"></div>');}var aj=a.getHashParam("z");if(aj){ac.zoomLevel=Math.abs(parseInt(aj,10));}var ai=a.getHashParam("p");if(ai){ac.goDirectlyTo=parseInt(ai,10);}var ah=a.getHashParam("fullscreen");if(ah==="true"&&ac.enableFullscreen){q();}var ag=a.getHashParam("grid");if(ag==="true"&&ac.enableGrid){t();}if(!ac.inFullscreen&&!ac.inGrid){af(ac.zoomLevel);}z();};ab();this.getItemTitle=function(){return ac.itemTitle;};this.gotoPage=function(ag){return S(ag);};this.getCurrentPage=function(){return ac.currentPageIndex;};this.getZoomLevel=function(){return ac.zoomLevel;};this.zoomIn=function(ag){ac.zoomInCallback=ag;return B(ac.zoomLevel+1);};this.zoomOut=function(ag){ac.zoomOutCallback=ag;return B(ac.zoomLevel-1);};this.inViewport=function(ai,ak,ah){var ag=ai-1;var al=ac.heightAbovePages[ag]+ak;var aj=al+ah;return M(al,aj);};};a.fn.diva=function(c){return this.each(function(){var e=a(this);if(e.data("diva")){return;}var d=new b(this,c);e.data("diva",d);});};})(jQuery);