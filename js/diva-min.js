(function(b){var a=1;b.generateId=function(d){var c;do{c=(a++)+(d?"-"+d:"");}while(document.getElementById(c));return c;};})(jQuery);(function(a){a.executeCallback=function(c,b){if(typeof c=="function"){c.call(this,b);return true;}else{return false;}};})(jQuery);(function(a){a.getHashParam=function(b){var d=window.location.hash;if(d!=""){var e=(d.indexOf("&"+b+"=")>0)?d.indexOf("&"+b+"="):d.indexOf("#"+b+"=");if(e>=0){e+=b.length+2;var c=d.indexOf("&",e);if(c>e){return d.substring(e,c);}else{if(c<0){return d.substring(e);}}return"";}else{return false;}}else{return false;}};})(jQuery);(function(a){a.updateHashParam=function(c,e){var b=a.getHashParam(c);var f=window.location.hash;if(b!==e){if(typeof b=="string"){var h=(f.indexOf("&"+c+"=")>0)?f.indexOf("&"+c+"="):f.indexOf("#"+c+"=");var d=h+c.length+2+b.length;var g=(h==0)?"#":"&";window.location.replace(f.substring(0,h)+g+c+"="+e+f.substring(d));}else{if(f.length===0){window.location.replace("#"+c+"="+e);}else{window.location.replace(f+"&"+c+"="+e);}}}};})(jQuery);jQuery.fn.oneFingerScroll=function(){var c=0;var a;var b;$(this).bind("touchstart",function(d){var f=d.originalEvent;a=$(this).scrollTop()+f.touches[0].pageY;b=$(this).scrollLeft()+f.touches[0].pageX;f.preventDefault();});$(this).bind("touchmove",function(d){var f=d.originalEvent;$(this).scrollTop(a-f.touches[0].pageY);$(this).scrollLeft(b-f.touches[0].pageX);f.preventDefault();});return this;};(function(a){a.fn.dragscrollable=function(b){var d=a.extend({dragSelector:">:first",acceptPropagatedEvent:true,preventDefault:true},b||{});var c={mouseDownHandler:function(e){if(e.which!=1||(!e.data.acceptPropagatedEvent&&e.target!=this)){return false;}e.data.lastCoord={left:e.clientX,top:e.clientY};a.event.add(document,"mouseup",c.mouseUpHandler,e.data);a.event.add(document,"mousemove",c.mouseMoveHandler,e.data);if(e.data.preventDefault){e.preventDefault();return false;}},mouseMoveHandler:function(e){var f={left:(e.clientX-e.data.lastCoord.left),top:(e.clientY-e.data.lastCoord.top)};e.data.scrollable.scrollLeft(e.data.scrollable.scrollLeft()-f.left);e.data.scrollable.scrollTop(e.data.scrollable.scrollTop()-f.top);e.data.lastCoord={left:e.clientX,top:e.clientY};if(e.data.preventDefault){e.preventDefault();return false;}},mouseUpHandler:function(e){a.event.remove(document,"mousemove",c.mouseMoveHandler);a.event.remove(document,"mouseup",c.mouseUpHandler);if(e.data.preventDefault){e.preventDefault();return false;}}};this.each(function(){var e={scrollable:a(this),acceptPropagatedEvent:d.acceptPropagatedEvent,preventDefault:d.preventDefault};a(this).find(d.dragSelector).bind("mousedown",e,c.mouseDownHandler);});};})(jQuery);(function(d){var i,a;var e;var b;d.extend({pnotify_remove_all:function(){var k=e.data("pnotify");if(k&&k.length){d.each(k,function(){if(this.pnotify_remove){this.pnotify_remove();}});}},pnotify:function(n){if(!e){e=d("body");}if(!b){b=d(window);}var l;var p;if(typeof n!="object"){p=d.extend({},d.pnotify.defaults);p.pnotify_text=n;}else{p=d.extend({},d.pnotify.defaults,n);}if(p.pnotify_before_init){if(p.pnotify_before_init(p)===false){return null;}}var q;var m=function(v,s){k.css("display","none");var r=document.elementFromPoint(v.clientX,v.clientY);k.css("display","block");var u=d(r);var t=u.css("cursor");k.css("cursor",t!="auto"?t:"default");if(!q||q.get(0)!=r){if(q){f.call(q.get(0),"mouseleave",v.originalEvent);f.call(q.get(0),"mouseout",v.originalEvent);}f.call(r,"mouseenter",v.originalEvent);f.call(r,"mouseover",v.originalEvent);}f.call(r,s,v.originalEvent);q=u;};var k=d("<div />",{"class":"ui-pnotify "+p.pnotify_addclass,css:{display:"none"},mouseenter:function(r){if(p.pnotify_nonblock){r.stopPropagation();}if(p.pnotify_mouse_reset&&l=="out"){k.stop(true);l="in";k.css("height","auto").animate({width:p.pnotify_width,opacity:p.pnotify_nonblock?p.pnotify_nonblock_opacity:p.pnotify_opacity},"fast");}if(p.pnotify_nonblock){k.animate({opacity:p.pnotify_nonblock_opacity},"fast");}if(p.pnotify_hide&&p.pnotify_mouse_reset){k.pnotify_cancel_remove();}if(p.pnotify_closer&&!p.pnotify_nonblock){k.closer.show();}},mouseleave:function(r){if(p.pnotify_nonblock){r.stopPropagation();}q=null;k.css("cursor","auto");if(p.pnotify_nonblock&&l!="out"){k.animate({opacity:p.pnotify_opacity},"fast");}if(p.pnotify_hide&&p.pnotify_mouse_reset){k.pnotify_queue_remove();}k.closer.hide();d.pnotify_position_all();},mouseover:function(r){if(p.pnotify_nonblock){r.stopPropagation();}},mouseout:function(r){if(p.pnotify_nonblock){r.stopPropagation();}},mousemove:function(r){if(p.pnotify_nonblock){r.stopPropagation();m(r,"onmousemove");}},mousedown:function(r){if(p.pnotify_nonblock){r.stopPropagation();r.preventDefault();m(r,"onmousedown");}},mouseup:function(r){if(p.pnotify_nonblock){r.stopPropagation();r.preventDefault();m(r,"onmouseup");}},click:function(r){if(p.pnotify_nonblock){r.stopPropagation();m(r,"onclick");}},dblclick:function(r){if(p.pnotify_nonblock){r.stopPropagation();m(r,"ondblclick");}}});k.opts=p;if(p.pnotify_shadow&&!d.browser.msie){k.shadow_container=d("<div />",{"class":"ui-widget-shadow ui-corner-all ui-pnotify-shadow"}).prependTo(k);}k.container=d("<div />",{"class":"ui-widget ui-widget-content ui-corner-all ui-pnotify-container "+(p.pnotify_type=="error"?"ui-state-error":"ui-state-highlight")}).appendTo(k);k.pnotify_version="1.0.1";k.pnotify=function(r){var s=p;if(typeof r=="string"){p.pnotify_text=r;}else{p=d.extend({},p,r);}k.opts=p;if(p.pnotify_shadow!=s.pnotify_shadow){if(p.pnotify_shadow&&!d.browser.msie){k.shadow_container=d("<div />",{"class":"ui-widget-shadow ui-pnotify-shadow"}).prependTo(k);}else{k.children(".ui-pnotify-shadow").remove();}}if(p.pnotify_addclass===false){k.removeClass(s.pnotify_addclass);}else{if(p.pnotify_addclass!==s.pnotify_addclass){k.removeClass(s.pnotify_addclass).addClass(p.pnotify_addclass);}}if(p.pnotify_title===false){k.title_container.hide("fast");}else{if(p.pnotify_title!==s.pnotify_title){k.title_container.html(p.pnotify_title).show(200);}}if(p.pnotify_text===false){k.text_container.hide("fast");}else{if(p.pnotify_text!==s.pnotify_text){if(p.pnotify_insert_brs){p.pnotify_text=p.pnotify_text.replace(/\n/g,"<br />");}k.text_container.html(p.pnotify_text).show(200);}}if(p.pnotify_width!==s.pnotify_width){k.animate({width:p.pnotify_width});}if(p.pnotify_min_height!==s.pnotify_min_height){k.container.animate({minHeight:p.pnotify_min_height});}if(p.pnotify_opacity!==s.pnotify_opacity){k.fadeTo(p.pnotify_animate_speed,p.pnotify_opacity);}if(!p.pnotify_hide){k.pnotify_cancel_remove();}else{if(!s.pnotify_hide){k.pnotify_queue_remove();}}k.pnotify_queue_position();return k;};k.pnotify_queue_position=function(){if(a){clearTimeout(a);}a=setTimeout(d.pnotify_position_all,10);};k.pnotify_display=function(){if(!k.parent().length){k.appendTo(e);}if(p.pnotify_before_open){if(p.pnotify_before_open(k)===false){return;}}k.pnotify_queue_position();if(p.pnotify_animation=="fade"||p.pnotify_animation.effect_in=="fade"){k.show().fadeTo(0,0).hide();}else{if(p.pnotify_opacity!=1){k.show().fadeTo(0,p.pnotify_opacity).hide();}}k.animate_in(function(){if(p.pnotify_after_open){p.pnotify_after_open(k);}k.pnotify_queue_position();if(p.pnotify_hide){k.pnotify_queue_remove();}});};k.pnotify_remove=function(){if(k.timer){window.clearTimeout(k.timer);k.timer=null;}if(p.pnotify_before_close){if(p.pnotify_before_close(k)===false){return;}}k.animate_out(function(){if(p.pnotify_after_close){if(p.pnotify_after_close(k)===false){return;}}k.pnotify_queue_position();if(p.pnotify_remove){k.detach();}});};k.animate_in=function(s){l="in";var r;if(typeof p.pnotify_animation.effect_in!="undefined"){r=p.pnotify_animation.effect_in;}else{r=p.pnotify_animation;}if(r=="none"){k.show();s();}else{if(r=="show"){k.show(p.pnotify_animate_speed,s);}else{if(r=="fade"){k.show().fadeTo(p.pnotify_animate_speed,p.pnotify_opacity,s);}else{if(r=="slide"){k.slideDown(p.pnotify_animate_speed,s);}else{if(typeof r=="function"){r("in",s,k);}else{if(k.effect){k.effect(r,{},p.pnotify_animate_speed,s);}}}}}}};k.animate_out=function(s){l="out";var r;if(typeof p.pnotify_animation.effect_out!="undefined"){r=p.pnotify_animation.effect_out;}else{r=p.pnotify_animation;}if(r=="none"){k.hide();s();}else{if(r=="show"){k.hide(p.pnotify_animate_speed,s);}else{if(r=="fade"){k.fadeOut(p.pnotify_animate_speed,s);}else{if(r=="slide"){k.slideUp(p.pnotify_animate_speed,s);}else{if(typeof r=="function"){r("out",s,k);}else{if(k.effect){k.effect(r,{},p.pnotify_animate_speed,s);}}}}}}};k.pnotify_cancel_remove=function(){if(k.timer){window.clearTimeout(k.timer);}};k.pnotify_queue_remove=function(){k.pnotify_cancel_remove();k.timer=window.setTimeout(function(){k.pnotify_remove();},(isNaN(p.pnotify_delay)?0:p.pnotify_delay));};k.closer=d("<div />",{"class":"ui-pnotify-closer",css:{cursor:"pointer",display:"none"},click:function(){k.pnotify_remove();k.closer.hide();}}).append(d("<span />",{"class":"ui-icon ui-icon-circle-close"})).appendTo(k.container);k.title_container=d("<div />",{"class":"ui-pnotify-title",html:p.pnotify_title}).appendTo(k.container);if(p.pnotify_title===false){k.title_container.hide();}if(p.pnotify_insert_brs&&typeof p.pnotify_text=="string"){p.pnotify_text=p.pnotify_text.replace(/\n/g,"<br />");}k.text_container=d("<div />",{"class":"ui-pnotify-text",html:p.pnotify_text}).appendTo(k.container);if(p.pnotify_text===false){k.text_container.hide();}if(typeof p.pnotify_width=="string"){k.css("width",p.pnotify_width);}if(typeof p.pnotify_min_height=="string"){k.container.css("min-height",p.pnotify_min_height);}var o=e.data("pnotify");if(o==null||typeof o!="object"){o=[];}if(p.pnotify_stack.push=="top"){o=d.merge([k],o);}else{o=d.merge(o,[k]);}e.data("pnotify",o);if(p.pnotify_after_init){p.pnotify_after_init(k);}p.pnotify_stack.animation=false;k.pnotify_display();return k;}});var j=/^on/;var c=/^(dbl)?click$|^mouse(move|down|up|over|out|enter|leave)$|^contextmenu$/;var h=/^(focus|blur|select|change|reset)$|^key(press|down|up)$/;var g=/^(scroll|resize|(un)?load|abort|error)$/;var f=function(l,k){var m;l=l.toLowerCase();if(document.createEvent&&this.dispatchEvent){l=l.replace(j,"");if(l.match(c)){d(this).offset();m=document.createEvent("MouseEvents");m.initMouseEvent(l,k.bubbles,k.cancelable,k.view,k.detail,k.screenX,k.screenY,k.clientX,k.clientY,k.ctrlKey,k.altKey,k.shiftKey,k.metaKey,k.button,k.relatedTarget);}else{if(l.match(h)){m=document.createEvent("UIEvents");m.initUIEvent(l,k.bubbles,k.cancelable,k.view,k.detail);}else{if(l.match(g)){m=document.createEvent("HTMLEvents");m.initEvent(l,k.bubbles,k.cancelable);}}}if(!m){return;}this.dispatchEvent(m);}else{if(!l.match(j)){l="on"+l;}m=document.createEventObject(k);this.fireEvent(l,m);}};d.pnotify.defaults={pnotify_nonblock:false,pnotify_type:"notice",pnotify_opacity:1,pnotify_shadow:false,pnotify_closer:true,pnotify_delay:8000,pnotify_mouse_reset:true,pnotify_remove:true,pnotify_insert_brs:true,pnotify_stack:{dir1:"down",dir2:"left",push:"bottom"}};})(jQuery);(function(a){var b=function(q,A){var J={adaptivePadding:0.05,backendServer:"",enableAutoTitle:true,enableFullscreen:true,enableGotoPage:true,enableGrid:true,enableGridSlider:true,enableKeyScroll:true,enableSpaceScroll:false,enableZoomSlider:true,fixedPadding:10,iipServerBaseUrl:"",maxPagesPerRow:8,maxZoomLevel:0,minPagesPerRow:2,minZoomLevel:0,onFullscreen:null,onFullscreenEnter:null,onFullscreenExit:null,onJump:null,onReady:null,onScroll:null,onScrollDown:null,onScrollUp:null,onZoom:null,onZoomIn:null,onZoomOut:null,pagesPerRow:5,tileFadeSpeed:300,tileHeight:256,tileWidth:256,viewportMargin:200,zoomLevel:2};var af=a.extend({},J,A);var m={centerX:0,centerY:0,currentPageIndex:0,dimAfterZoom:0,dimBeforeZoom:0,doubleClick:false,elementSelector:"",firstAjaxRequest:true,firstPageLoaded:-1,firstRowLoaded:-1,fullscreenStatusbar:null,goDirectlyTo:0,heightAbovePages:[],horizontalOffset:0,horizontalPadding:0,ID:null,inFullscreen:false,inGrid:false,itemTitle:"",lastPageLoaded:-1,lastRowLoaded:-1,maxHeight:0,maxWidth:0,mobileSafari:false,numPages:0,numRows:0,pages:[],panelHeight:0,panelWidth:0,prevVptTop:0,scaleWait:false,selector:"",scrollSoFar:0,totalHeight:0,verticalOffset:0,verticalPadding:0,viewerXOffset:0,viewerYOffset:0,zoomInCallback:null,zoomOutCallback:null};a.extend(af,m);var P=function(an,ak){var al=af.panelHeight;var aj=af.scrollSoFar-af.viewportMargin;var am=aj+al+af.viewportMargin*2;if(an>=aj&&an<=am){return true;}else{if(ak>=aj&&ak<=am){return true;}else{if(an<=aj&&ak>=am){return true;}else{return false;}}}};var l=function(aj){if(a(af.selector+"page-"+aj).length===0){return false;}else{return true;}};var aa=function(aj){var ak=af.heightAbovePages[aj];var al=ak+af.pages[aj].h+af.verticalPadding;return P(ak,al);};var t=function(aj,al,an){var ak=af.heightAbovePages[aj]+(al*af.tileHeight)+af.verticalPadding;var am=ak+af.tileHeight;return P(ak,am);};var S=function(aj,ak){if(a(af.selector+"tile-"+aj+"-"+ak).length>0){return true;}else{return false;}};var u=function(az){var aE=[];var aF=af.pages[az].fn;var av=af.pages[az].r;var ax=af.pages[az].c;var aD=af.pages[az].w;var aA=af.pages[az].h;var aC=af.pages[az].m_z;var aw,ap;var aH,al,ar,aq,at,aj,ak;var aJ=0;var an=af.heightAbovePages[az]+af.verticalPadding;if(!l(az)){aE.push('<div id="'+af.ID+"page-"+az+'" style="top: '+an+"px; width: "+aD+"px; height: "+aA+"px; left: 50%; margin-left: -"+(aD/2)+'px" class="diva-page">');}aH=aA-(av-1)*af.tileHeight;al=aD-(ax-1)*af.tileWidth;var aI=[];for(ar=0;ar<av;ar++){for(aq=0;aq<ax;aq++){var ay=ar*af.tileHeight;var ao=aq*af.tileWidth;var au=(af.tileFadeSpeed)?"none":"inline";var aB=(aC===af.maxZoomLevel)?af.zoomLevel:af.zoomLevel+(aC-af.maxZoomLevel);at=(ar===av-1)?aH:af.tileHeight;aj=(aq===ax-1)?al:af.tileWidth;ak=af.iipServerBaseUrl+aF+"&amp;JTL="+aB+","+aJ;if(!S(az,aJ)&&t(az,ar,aq)){aE.push('<div id="'+af.ID+"tile-"+az+"-"+aJ+'"style="display: '+au+"; position: absolute; top: "+ay+"px; left: "+ao+"px; background-image: url('"+ak+"'); height: "+at+"px; width: "+aj+'px;"></div>');}aI.push(aJ);aJ++;}}if(!l(az)){aE.push("</div>");var am=aE.join("");a(af.innerSelector).append(am);}else{a(af.selector+"page-"+az).append(aE.join(""));}if(af.tileFadeSpeed){for(var aG=0;aG<aI.length;aG++){a(af.selector+"tile-"+az+"-"+aI[aG]).fadeIn(af.tileFadeSpeed);}}};var K=function(aj){if(l(aj)){a(af.selector+"page-"+aj).remove();}};var o=function(aj){if(aj>=0&&aj<af.numRows){return true;}else{return false;}};var U=function(aj){if(aj>=0&&aj<af.numPages){return true;}else{return false;}};var W=function(ak){var al=af.heightAbovePages[ak]+af.pages[ak].h+af.verticalPadding;var aj=af.scrollSoFar;if(al<aj){return true;}else{return false;}};var d=function(aj){var ak=af.heightAbovePages[aj];var al=af.scrollSoFar+af.panelHeight;if(ak>al){return true;}else{return false;}};var ac=function(al){var ak=af.rowHeight*(al+1);var aj=af.scrollSoFar;if(ak<aj){return true;}else{return false;}};var g=function(al){var aj=af.rowHeight*al;var ak=af.scrollSoFar+af.panelHeight;if(aj>ak){return true;}else{return false;}};var R=function(aj){var ak=aj+1;a.updateHashParam("p",""+ak);a(af.selector+"current span").text(ak);if(af.inFullscreen){if(af.fullscreenStatusbar===null){h("fade");}af.fullscreenStatusbar.pnotify({pnotify_title:"Page: "+ak});}};var x=function(an){var al=af.currentPageIndex;var aj=af.currentPageIndex+parseInt(an,10);var am=af.scrollSoFar+(af.panelHeight/2);var ak=false;if(an<0){if(aj>=0&&(af.heightAbovePages[al]>=am||af.heightAbovePages[aj]>=af.scrollSoFar)){ak=true;}}else{if(an>0){if(af.heightAbovePages[al]+af.pages[al].h<af.scrollSoFar&&aj<af.pages.length){ak=true;}}}if(ak){af.currentPageIndex=aj;if(an!==0){if(!x(an)){R(aj);}}return true;}else{return false;}};var C=function(aj,ak){if(ak>0){if(U(aj)){if(aa(aj)){u(aj);af.lastPageLoaded=aj;C(af.lastPageLoaded+1,ak);}else{if(W(aj)){C(aj+1,ak);}}}else{return;}}else{if(U(aj)){if(aa(aj)){u(aj);af.firstPageLoaded=aj;C(af.firstPageLoaded-1,ak);}else{if(d(aj)){C(aj-1,ak);}}}else{return;}}};var L=function(aj,ak){if(ak>0){if(U(aj)&&W(aj)){K(aj);af.firstPageLoaded++;L(af.firstPageLoaded,ak);}else{return;}}else{if(U(aj)&&d(aj)){K(aj);af.lastPageLoaded--;L(af.lastPageLoaded,ak);}else{return;}}};var F=function(ak,aj){if(aj>0){if(o(ak)){if(Y(ak)){k(ak);af.lastRowLoaded=ak;F(af.lastRowLoaded+1,aj);}else{if(ac(ak)){F(ak+1,aj);}}}}else{if(o(ak)){if(Y(ak)){k(ak);af.currentPageIndex=af.firstRowLoaded*af.pagesPerRow;R(af.currentPageIndex);af.firstRowLoaded=ak;F(af.firstRowLoaded-1,aj);}else{if(g(ak)){F(ak-1,aj);}}}}};var I=function(aj){if(O(aj)){a(af.selector+"row-"+aj).remove();}};var Q=function(ak,aj){if(aj>0){if(o(ak)&&ac(ak)){I(ak);af.firstRowLoaded++;af.currentPageIndex=af.firstRowLoaded*af.pagesPerRow;R(af.currentPageIndex);Q(af.firstRowLoaded,aj);}}else{if(o(ak)&&g(ak)){I(ak);af.lastRowLoaded--;Q(af.lastRowLoaded,aj);}}};var M=function(aj){if(aj<0){F(af.firstRowLoaded,-1);Q(af.lastRowLoaded,-1);}else{if(aj>0){Q(af.firstRowLoaded,1);F(af.lastRowLoaded,1);}}};var w=function(aj){if(aj<0){C(af.firstPageLoaded,aj);x(-1);L(af.lastPageLoaded,aj);}else{if(aj>0){L(af.firstPageLoaded,aj);C(af.lastPageLoaded,aj);x(1);}}if(aj!==0){a.executeCallback(af.onScroll,af.currentPageIndex);if(aj>0){a.executeCallback(af.onScrollDown,af.currentPageIndex);}else{a.executeCallback(af.onScrollUp,af.currentPageIndex);}}};var j=function(){if(af.goDirectlyTo){V(af.goDirectlyTo);R(af.goDirectlyTo-1);af.goDirectlyTo=0;return true;}return false;};var ag=function(){if(j()){return;}var an,am,al,aj;var ak=(af.dimBeforeZoom>0)?af.dimAfterZoom/af.dimBeforeZoom:1;if(af.doubleClick){an=af.centerX*ak;am=af.centerY*ak;al=Math.max((an)-(af.panelWidth/2),0);aj=Math.max((am)-(af.panelHeight/2),0);}else{al=af.maxWidth/2-af.panelWidth/2+af.horizontalPadding;aj=af.verticalOffset*ak;}af.prevVptTop=0;a(af.outerSelector).scrollTop(aj);a(af.outerSelector).scrollLeft(al);};var i=function(ak,aj){a.ajax({url:af.backendServer+="&z="+ak,cache:true,context:this,dataType:"json",success:function(al){if(af.firstAjaxRequest){n(al,ak);}c();af.pages=al.pgs;af.maxWidth=al.dims.max_w;af.maxHeight=al.dims.max_h;a.executeCallback(aj,al);af.firstAjaxRequest=false;}});};var n=function(aj,ak){af.itemTitle=aj.item_title;af.numPages=aj.pgs.length;af.maxZoomLevel=(af.maxZoomLevel>0&&af.maxZoomLevel<=aj.max_zoom)?af.maxZoomLevel:aj.max_zoom;if(ak>af.maxZoomLevel){ak=0;}a(af.selector+"current label").text(af.numPages);if(af.enableAutoTitle){a(af.elementSelector).prepend('<div id="'+af.ID+'title">'+af.itemTitle+"</div>");}};var O=function(aj){if(a(af.selector+"row-"+aj).length>0){return true;}else{return false;}};var Y=function(al){var ak=af.rowHeight*al;var aj=ak+af.rowHeight+af.fixedPadding;return P(ak,aj);};var k=function(ap){if(O(ap)){return;}var ao;var aj=(af.rowHeight)*ap+af.fixedPadding;var am=[];am.push('<div id="'+af.ID+"row-"+ap+'" style="width: 100%; height: '+af.rowHeight+"; position: absolute; top: "+aj+'px;">');for(ao=0;ao<af.pagesPerRow;ao++){var an=ap*af.pagesPerRow+ao;if(!U(an)){break;}var aq=an+1;var ak=af.pages[an].fn;var ar=af.iipServerBaseUrl+ak+"&amp;WID="+af.gridPageWidth+"&amp;CVT=JPG";var al=ao*(af.fixedPadding+af.gridPageWidth)+af.fixedPadding;am.push('<div id="'+af.ID+"page-"+an+'" style="position: absolute; left: '+al+"px; display: inline; background-image: url('"+ar+"'); background-repeat: no-repeat; width: "+af.gridPageWidth+"px; height: "+af.rowHeight+'px;"></div>');}a(af.innerSelector).append(am.join(""));};var f=function(){i(0,function(al){if(af.enableGridSlider){D();}var am=af.fixedPadding*(af.pagesPerRow+1);var aj=(af.panelWidth-am)/af.pagesPerRow;af.gridPageWidth=aj;af.rowHeight=af.fixedPadding+al.dims.max_ratio*aj;af.numRows=Math.ceil(af.numPages/af.pagesPerRow);af.totalHeight=af.numRows*af.rowHeight+af.fixedPadding;a(af.innerSelector).css("height",Math.round(af.totalHeight));a(af.innerSelector).css("width",Math.round(af.panelWidth));if(!j()){V(af.currentPageIndex+1);}af.scrollSoFar=a(af.outerSelector).scrollTop();for(var ak=0;ak<af.numPages;ak+=af.pagesPerRow){var an=Math.floor(ak/af.pagesPerRow);if(Y(an)){af.firstRowLoaded=(af.firstRowLoaded<0)?an:af.firstRowLoaded;k(an);af.lastRowLoaded=an;}}});};var c=function(){a(af.outerSelector).scrollTop(0);af.scrollSoFar=0;a(af.innerSelector).text("");af.firstPageLoaded=0;};var ai=function(aj){i(aj,function(an){if(af.adaptivePadding>0){af.horizontalPadding=an.dims.a_wid*af.adaptivePadding;af.verticalPadding=an.dims.a_hei*af.adaptivePadding;}else{af.horizontalPadding=af.fixedPadding;af.verticalPadding=af.fixedPadding;}af.totalHeight=an.dims.t_hei+af.verticalPadding*(af.numPages+1);af.zoomLevel=aj;af.dimAfterZoom=af.totalHeight;if(af.enableZoomSlider){N();}var ak=0;for(var al=0;al<af.numPages;al++){af.heightAbovePages[al]=ak;ak=af.heightAbovePages[al]+af.pages[al].h+af.verticalPadding;if(aa(al)){u(al);af.lastPageLoaded=al;}}a(af.innerSelector).css("height",Math.round(af.totalHeight));var am=(an.dims.max_w+af.horizontalPadding*2<af.panelWidth)?af.panelWidth:an.dims.max_w+af.horizontalPadding*2;a(af.innerSelector).css("width",Math.round(am));ag();if(!af.firstAjaxRequest){if(af.dimBeforeZoom!==af.dimAfterZoom){a.executeCallback(af.onZoom,aj);if(af.dimBeforeZoom>af.dimAfterZoom){a.executeCallback(af.onZoomOut,aj);a.executeCallback(af.zoomOutCallback,aj);af.zoomOutCallback=null;}else{a.executeCallback(af.onZoomIn,aj);a.executeCallback(af.zoomInCallback,aj);af.zoomInCallback=null;}}else{a.executeCallback(af.onFullscreen,aj);}}else{a.executeCallback(af.onReady);}af.dimBeforeZoom=af.dimAfterZoom;if(af.scaleWait){af.scaleWait=false;}});};var ab=function(){af.scrollSoFar=a(af.outerSelector).scrollTop();w(af.scrollSoFar-af.prevVptTop);af.prevVptTop=af.scrollSoFar;};var ah=function(){af.scrollSoFar=a(af.outerSelector).scrollTop();M(af.scrollSoFar-af.prevVptTop);af.prevVptTop=af.scrollSoFar;};var E=function(aj){if(af.zoomLevel!=aj&&aj>=af.minZoomLevel&&aj<=af.maxZoomLevel){ai(aj);a(af.selector+"zoom-slider").slider({value:aj});a.updateHashParam("z",""+aj);return true;}else{a.executeCallback(af.zoomInCallback,af.zoomLevel);a.executeCallback(af.zoomOutCallback,af.zoomLevel);af.zoomOutCallback=null;af.zoomInCallback=null;return false;}};var Z=function(aj){af.verticalOffset=a(af.outerSelector).scrollTop();af.horizontalOffset=a(af.outerSelector).scrollLeft();if(af.inGrid){e(true);}af.doubleClick=false;E(aj);};var V=function(aj){if(af.inGrid){var am=Math.ceil(aj/af.pagesPerRow)-1;if(o(am)){var al=am*af.rowHeight;a(af.outerSelector).scrollTop(al);R(aj-1);af.currentPageIndex=aj-1;return true;}}else{pageIndex=aj-1;if(U(pageIndex)){var al=af.heightAbovePages[pageIndex];R(pageIndex);a(af.outerSelector).scrollTop(al);var ak=(a(af.innerSelector).width()-af.panelWidth)/2;a(af.outerSelector).scrollLeft(ak);a.executeCallback(af.onJump,aj);return true;}}return false;};var G=function(ak){var aj;if(af.zoomLevel===af.maxZoomLevel){if(ak.ctrlKey){aj=af.zoomLevel-1;}else{return;}}else{if(af.zoomLevel===af.minZoomLevel){if(ak.ctrlKey){return;}else{aj=af.zoomLevel+1;}}else{if(ak.ctrlKey){aj=af.zoomLevel-1;}else{aj=af.zoomLevel+1;}}}af.centerX=(ak.pageX-af.viewerXOffset)+a(af.outerSelector).scrollLeft();af.centerY=(ak.pageY-af.viewerYOffset)+a(af.outerSelector).scrollTop();af.doubleClick=true;E(aj);};var z=function(aj){aj.preventDefault();};var H=function(ak){var aj=af.zoomLevel;if(ak.scale>1&&aj<af.maxZoomLevel){aj++;}else{if(ak.scale<1&&aj>af.minZoomLevel){aj--;}else{return;}}af.scaleWait=true;Z(aj);};var s=function(){af.verticalOffset=a(af.outerSelector).scrollTop();af.horizontalOffset=a(af.outerSelector).scrollLeft();af.doubleClick=false;a(af.innerSelector).text("");if(af.inFullscreen){T();a.updateHashParam("fullscreen","false");}else{ad();a.updateHashParam("fullscreen","true");}af.panelWidth=parseInt(a(af.outerSelector).width(),10)-20;af.panelHeight=parseInt(a(af.outerSelector).height(),10);a(af.innerSelector).width(af.panelWidth);if(af.inGrid){f();}else{ai(af.zoomLevel);}};var ad=function(){if(af.fullscreenStatusbar==null){h("none");}a(af.selector+"fullscreen").css("position","fixed").css("z-index","9001");a(af.outerSelector).addClass("fullscreen");af.inFullscreen=true;a("body").css("overflow","hidden");a.executeCallback(af.onFullscreenEnter);};var T=function(){if(af.fullscreenStatusbar!=null){af.fullscreenStatusbar.pnotify({pnotify_animation:"none"});af.fullscreenStatusbar.pnotify_remove();af.fullscreenStatusbar=null;}a(af.outerSelector).removeClass("fullscreen");af.inFullscreen=false;a(af.selector+"fullscreen").css("position","absolute").css("z-index","8999");a.executeCallback(af.onFullscreenExit);};var v=function(){if(af.inGrid){e();}else{y();}};var y=function(){af.inGrid=true;f();a.updateHashParam("grid","true");};var e=function(aj){af.inGrid=false;if(!af.goDirectlyTo){af.goDirectlyTo=af.currentPageIndex+1;}if(!aj){ai(af.zoomLevel);}a.updateHashParam("grid","false");};var B=function(){if(af.enableGrid){a(af.selector+"grid-icon").click(function(){v();});}if(af.enableFullscreen){a(af.selector+"fullscreen").click(function(){s();});var ak;a(window).resize(function(){clearTimeout(ak);ak=setTimeout(function(){af.panelHeight=parseInt(a(af.outerSelector).height(),10);w(1);var ao=a("body").css("width");a(af.innerSelector).css("width",ao);},10);});}a(af.innerSelector).mouseover(function(){a(this).removeClass("grabbing").addClass("grab");});a(af.innerSelector).mouseout(function(){a(this).removeClass("grab");});a(af.innerSelector).mousedown(function(){a(this).removeClass("grab").addClass("grabbing");});a(af.innerSelector).mouseup(function(){a(this).removeClass("grabbing").addClass("grab");});a(af.outerSelector+", "+af.innerSelector).dragscrollable({dragSelector:".dragger",acceptPropagatedEvent:true});a(af.outerSelector).scroll(function(){if(af.inGrid){ah();}else{ab();}});a(af.outerSelector).dblclick(function(aq){af.viewerXOffset=this.offsetLeft;af.viewerYOffset=this.offsetTop;if(af.inGrid){var at=(aq.pageX-af.viewerXOffset)+a(af.outerSelector).scrollLeft();var ar=(aq.pageY-af.viewerYOffset)+a(af.outerSelector).scrollTop();var au=Math.floor(ar/af.rowHeight);var ap=Math.floor(at/(af.panelWidth/af.pagesPerRow));var ao=au*af.pagesPerRow+ap+1;af.goDirectlyTo=ao;e();}else{G(aq);}});a(af.outerSelector).bind("contextmenu",function(ao){var ap=ao.originalEvent;if(ap.ctrlKey){ap.preventDefault();ap.stopPropagation();}});if(af.mobileSafari){a(af.outerSelector).oneFingerScroll();var al=[];al.push('<meta name="viewport" content="user-scalable=no, width=device-width" />');al.push('<meta name="apple-mobile-web-app-capable" content="yes" />');al.push('<meta name="apple-mobile-web-app-status-bar-style" content="black" />');a("head").append(al.join("\n"));a("body").bind("touchmove",function(ao){var ap=ao.originalEvent;z(ap);});a("body").bind("gestureend",function(ao){var ap=ao.originalEvent;if(!af.scaleWait){if(af.inGrid){e();}else{H(ap);}}return false;});}if(af.enableSpaceScroll||af.enableKeyScroll){var am=a.ui.keyCode.SPACE;var aj=a.ui.keyCode.PAGE_UP;var an=a.ui.keyCode.PAGE_DOWN;a(document).keydown(function(ao){if((af.enableSpaceScroll&&ao.keyCode==am)||(af.enableKeyScroll&&ao.keyCode==an)){a(af.outerSelector).scrollTop(af.scrollSoFar+af.panelHeight);return false;}if(af.enableKeyScroll&&ao.keyCode==aj){a(af.outerSelector).scrollTop(af.scrollSoFar-af.panelHeight);return false;}});}};var h=function(ak){var aj={pnotify_text:'<form id="'+af.ID+'goto-page-fullscreen"><input placeholder="'+af.numPages+'" type="text" size="4" id="'+af.ID+'goto-input-fullscreen" /><input type="submit" value="Go"></form>',pnotify_title:"Page: "+(af.currentPageIndex+1),pnotify_history:false,pnotify_width:"110px",pnotify_hide:false,pnotify_notice_icon:"",pnotify_animation:ak,pnotify_before_close:function(){af.fullscreenStatusbar=null;}};af.fullscreenStatusbar=a.pnotify(aj);a(af.selector+"goto-page-fullscreen").submit(function(){var al=parseInt(a(af.selector+"goto-input-fullscreen").val(),10);if(!V(al)){alert("Invalid page number");}return false;});};var N=function(){a(af.selector+"slider").remove();a(af.selector+"slider-label").remove();a(af.selector+"tools").prepend('<div id="'+af.ID+'slider"></div>');a(af.selector+"slider").slider({value:af.zoomLevel,min:af.minZoomLevel,max:af.maxZoomLevel,step:1,slide:function(aj,ak){Z(ak.value);}});a(af.selector+"slider").after('<div id="'+af.ID+'slider-label">Zoom level: <span>'+af.zoomLevel+"</span></div>");};var D=function(){a(af.selector+"slider").remove();a(af.selector+"slider-label").remove();a(af.selector+"tools").prepend('<div id="'+af.ID+'slider"></div>');a(af.selector+"slider").slider({value:af.pagesPerRow,min:af.minPagesPerRow,max:af.maxPagesPerRow,step:1,slide:function(aj,ak){r(ak.value);}});a(af.selector+"slider").after('<div id="'+af.ID+'slider-label">Pages per row: <span>'+af.pagesPerRow+"</span></div>");};var r=function(aj){af.pagesPerRow=aj;y();};var X=function(){a(af.selector+"tools").prepend('<div id="'+af.ID+'grid-icon"></div>');};var p=function(){a(af.selector+"tools").append('<form id="'+af.ID+'goto-page">Go to page <input type="text" size="3" id="'+af.ID+'goto-input" /> <input type="submit" value="Go" /><br /><div id="'+af.ID+'current">Current page: <span>1</span> of <label></label></div></form>');a(af.selector+"goto-page").submit(function(){var aj=parseInt(a(af.selector+"goto-input").val(),10);if(!V(aj)){alert("Invalid page number");}return false;});};var ae=function(){af.mobileSafari=navigator.platform=="iPad"||navigator.platform=="iPhone"||navigator.platform=="iPod";af.elementSelector="#"+a(q).attr("id");af.ID=a.generateId("diva-");af.selector="#"+af.ID;af.outerSelector=af.selector+"outer";af.innerSelector=af.selector+"inner";if(af.zoomSlider||af.enableGotoPage||af.enableGrid){a(af.elementSelector).prepend('<div id="'+af.ID+'tools"></div>');}if(af.enableGotoPage){p();}if(af.enableGrid){X();}a(af.elementSelector).append('<div id="'+af.ID+'outer"></div>');a(af.outerSelector).append('<div id="'+af.ID+'inner" class="dragger"></div>');if(af.mobileSafari){af.panelWidth=screen.width-20;if(navigator.platform=="iPad"){af.panelHeight=screen.height-170;}else{af.panelHeight=screen.height-250;}a(af.elementSelector).css("width",af.panelWidth);a(af.outerSelector).css("width",af.panelWidth+"px");a(af.outerSelector).css("height",af.panelHeight+"px");}else{af.panelWidth=parseInt(a(af.elementSelector).width(),10)-18;a(af.outerSelector).css("width",(af.panelWidth+18)+"px");af.panelHeight=parseInt(a(af.outerSelector).height(),10);}if(af.enableFullscreen){a(af.elementSelector).prepend('<div id="'+af.ID+'fullscreen"></div>');}var am=a.getHashParam("z");if(am){af.zoomLevel=Math.abs(parseInt(am,10));}var al=a.getHashParam("p");if(al){af.goDirectlyTo=parseInt(al,10);}var ak=a.getHashParam("fullscreen");if(ak==="true"&&af.enableFullscreen){s();}var aj=a.getHashParam("grid");if(aj==="true"&&af.enableGrid){v();}if(!af.inFullscreen&&!af.inGrid){ai(af.zoomLevel);}B();};ae();this.getItemTitle=function(){return af.itemTitle;};this.gotoPage=function(aj){return V(aj);};this.getCurrentPage=function(){return af.currentPageIndex;};this.getZoomLevel=function(){return af.zoomLevel;};this.zoomIn=function(aj){af.zoomInCallback=aj;return E(af.zoomLevel+1);};this.zoomOut=function(aj){af.zoomOutCallback=aj;return E(af.zoomLevel-1);};this.inViewport=function(al,an,ak){var aj=al-1;var ao=af.heightAbovePages[aj]+an;var am=ao+ak;return P(ao,am);};};a.fn.diva=function(c){return this.each(function(){var e=a(this);if(e.data("diva")){return;}var d=new b(this,c);e.data("diva",d);});};})(jQuery);