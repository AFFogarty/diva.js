(function(b){var a=1;b.generateId=function(d){var c;do{c=(a++)+(d?"-"+d:"");}while(document.getElementById(c));return c;};})(jQuery);(function(a){a.executeCallback=function(c,b){if(typeof c=="function"){c.call(this,b);return true;}else{return false;}};})(jQuery);(function(a){a.getHashParam=function(b){var d=window.location.hash;if(d!=""){var e=(d.indexOf("&"+b+"=")>0)?d.indexOf("&"+b+"="):d.indexOf("#"+b+"=");if(e>=0){e+=b.length+2;var c=d.indexOf("&",e);if(c>e){return d.substring(e,c);}else{if(c<0){return d.substring(e);}}return"";}else{return false;}}else{return false;}};})(jQuery);(function(a){a.updateHashParam=function(c,e){var b=a.getHashParam(c);var f=window.location.hash;if(b!==e){if(typeof b=="string"){var h=(f.indexOf("&"+c+"=")>0)?f.indexOf("&"+c+"="):f.indexOf("#"+c+"=");var d=h+c.length+2+b.length;var g=(h==0)?"#":"&";window.location.replace(f.substring(0,h)+g+c+"="+e+f.substring(d));}else{if(f.length===0){window.location.replace("#"+c+"="+e);}else{window.location.replace(f+"&"+c+"="+e);}}}};})(jQuery);jQuery.fn.oneFingerScroll=function(){var c=0;var a;var b;$(this).bind("touchstart",function(d){var f=d.originalEvent;a=$(this).scrollTop()+f.touches[0].pageY;b=$(this).scrollLeft()+f.touches[0].pageX;f.preventDefault();});$(this).bind("touchmove",function(d){var f=d.originalEvent;$(this).scrollTop(a-f.touches[0].pageY);$(this).scrollLeft(b-f.touches[0].pageX);f.preventDefault();});return this;};(function(a){a.fn.dragscrollable=function(b){var d=a.extend({dragSelector:">:first",acceptPropagatedEvent:true,preventDefault:true},b||{});var c={mouseDownHandler:function(e){if(e.which!=1||(!e.data.acceptPropagatedEvent&&e.target!=this)){return false;}e.data.lastCoord={left:e.clientX,top:e.clientY};a.event.add(document,"mouseup",c.mouseUpHandler,e.data);a.event.add(document,"mousemove",c.mouseMoveHandler,e.data);if(e.data.preventDefault){e.preventDefault();return false;}},mouseMoveHandler:function(e){var f={left:(e.clientX-e.data.lastCoord.left),top:(e.clientY-e.data.lastCoord.top)};e.data.scrollable.scrollLeft(e.data.scrollable.scrollLeft()-f.left);e.data.scrollable.scrollTop(e.data.scrollable.scrollTop()-f.top);e.data.lastCoord={left:e.clientX,top:e.clientY};if(e.data.preventDefault){e.preventDefault();return false;}},mouseUpHandler:function(e){a.event.remove(document,"mousemove",c.mouseMoveHandler);a.event.remove(document,"mouseup",c.mouseUpHandler);if(e.data.preventDefault){e.preventDefault();return false;}}};this.each(function(){var e={scrollable:a(this),acceptPropagatedEvent:d.acceptPropagatedEvent,preventDefault:d.preventDefault};a(this).find(d.dragSelector).bind("mousedown",e,c.mouseDownHandler);});};})(jQuery);(function(d){var i,a;var e;var b;d.extend({pnotify_remove_all:function(){var k=e.data("pnotify");if(k&&k.length){d.each(k,function(){if(this.pnotify_remove){this.pnotify_remove();}});}},pnotify:function(n){if(!e){e=d("body");}if(!b){b=d(window);}var l;var p;if(typeof n!="object"){p=d.extend({},d.pnotify.defaults);p.pnotify_text=n;}else{p=d.extend({},d.pnotify.defaults,n);}if(p.pnotify_before_init){if(p.pnotify_before_init(p)===false){return null;}}var q;var m=function(v,s){k.css("display","none");var r=document.elementFromPoint(v.clientX,v.clientY);k.css("display","block");var u=d(r);var t=u.css("cursor");k.css("cursor",t!="auto"?t:"default");if(!q||q.get(0)!=r){if(q){f.call(q.get(0),"mouseleave",v.originalEvent);f.call(q.get(0),"mouseout",v.originalEvent);}f.call(r,"mouseenter",v.originalEvent);f.call(r,"mouseover",v.originalEvent);}f.call(r,s,v.originalEvent);q=u;};var k=d("<div />",{"class":"ui-pnotify "+p.pnotify_addclass,css:{display:"none"},mouseenter:function(r){if(p.pnotify_nonblock){r.stopPropagation();}if(p.pnotify_mouse_reset&&l=="out"){k.stop(true);l="in";k.css("height","auto").animate({width:p.pnotify_width,opacity:p.pnotify_nonblock?p.pnotify_nonblock_opacity:p.pnotify_opacity},"fast");}if(p.pnotify_nonblock){k.animate({opacity:p.pnotify_nonblock_opacity},"fast");}if(p.pnotify_hide&&p.pnotify_mouse_reset){k.pnotify_cancel_remove();}if(p.pnotify_closer&&!p.pnotify_nonblock){k.closer.show();}},mouseleave:function(r){if(p.pnotify_nonblock){r.stopPropagation();}q=null;k.css("cursor","auto");if(p.pnotify_nonblock&&l!="out"){k.animate({opacity:p.pnotify_opacity},"fast");}if(p.pnotify_hide&&p.pnotify_mouse_reset){k.pnotify_queue_remove();}k.closer.hide();d.pnotify_position_all();},mouseover:function(r){if(p.pnotify_nonblock){r.stopPropagation();}},mouseout:function(r){if(p.pnotify_nonblock){r.stopPropagation();}},mousemove:function(r){if(p.pnotify_nonblock){r.stopPropagation();m(r,"onmousemove");}},mousedown:function(r){if(p.pnotify_nonblock){r.stopPropagation();r.preventDefault();m(r,"onmousedown");}},mouseup:function(r){if(p.pnotify_nonblock){r.stopPropagation();r.preventDefault();m(r,"onmouseup");}},click:function(r){if(p.pnotify_nonblock){r.stopPropagation();m(r,"onclick");}},dblclick:function(r){if(p.pnotify_nonblock){r.stopPropagation();m(r,"ondblclick");}}});k.opts=p;if(p.pnotify_shadow&&!d.browser.msie){k.shadow_container=d("<div />",{"class":"ui-widget-shadow ui-corner-all ui-pnotify-shadow"}).prependTo(k);}k.container=d("<div />",{"class":"ui-widget ui-widget-content ui-corner-all ui-pnotify-container "+(p.pnotify_type=="error"?"ui-state-error":"ui-state-highlight")}).appendTo(k);k.pnotify_version="1.0.1";k.pnotify=function(r){var s=p;if(typeof r=="string"){p.pnotify_text=r;}else{p=d.extend({},p,r);}k.opts=p;if(p.pnotify_shadow!=s.pnotify_shadow){if(p.pnotify_shadow&&!d.browser.msie){k.shadow_container=d("<div />",{"class":"ui-widget-shadow ui-pnotify-shadow"}).prependTo(k);}else{k.children(".ui-pnotify-shadow").remove();}}if(p.pnotify_addclass===false){k.removeClass(s.pnotify_addclass);}else{if(p.pnotify_addclass!==s.pnotify_addclass){k.removeClass(s.pnotify_addclass).addClass(p.pnotify_addclass);}}if(p.pnotify_title===false){k.title_container.hide("fast");}else{if(p.pnotify_title!==s.pnotify_title){k.title_container.html(p.pnotify_title).show(200);}}if(p.pnotify_text===false){k.text_container.hide("fast");}else{if(p.pnotify_text!==s.pnotify_text){if(p.pnotify_insert_brs){p.pnotify_text=p.pnotify_text.replace(/\n/g,"<br />");}k.text_container.html(p.pnotify_text).show(200);}}if(p.pnotify_width!==s.pnotify_width){k.animate({width:p.pnotify_width});}if(p.pnotify_min_height!==s.pnotify_min_height){k.container.animate({minHeight:p.pnotify_min_height});}if(p.pnotify_opacity!==s.pnotify_opacity){k.fadeTo(p.pnotify_animate_speed,p.pnotify_opacity);}if(!p.pnotify_hide){k.pnotify_cancel_remove();}else{if(!s.pnotify_hide){k.pnotify_queue_remove();}}k.pnotify_queue_position();return k;};k.pnotify_queue_position=function(){if(a){clearTimeout(a);}a=setTimeout(d.pnotify_position_all,10);};k.pnotify_display=function(){if(!k.parent().length){k.appendTo(e);}if(p.pnotify_before_open){if(p.pnotify_before_open(k)===false){return;}}k.pnotify_queue_position();if(p.pnotify_animation=="fade"||p.pnotify_animation.effect_in=="fade"){k.show().fadeTo(0,0).hide();}else{if(p.pnotify_opacity!=1){k.show().fadeTo(0,p.pnotify_opacity).hide();}}k.animate_in(function(){if(p.pnotify_after_open){p.pnotify_after_open(k);}k.pnotify_queue_position();if(p.pnotify_hide){k.pnotify_queue_remove();}});};k.pnotify_remove=function(){if(k.timer){window.clearTimeout(k.timer);k.timer=null;}if(p.pnotify_before_close){if(p.pnotify_before_close(k)===false){return;}}k.animate_out(function(){if(p.pnotify_after_close){if(p.pnotify_after_close(k)===false){return;}}k.pnotify_queue_position();if(p.pnotify_remove){k.detach();}});};k.animate_in=function(s){l="in";var r;if(typeof p.pnotify_animation.effect_in!="undefined"){r=p.pnotify_animation.effect_in;}else{r=p.pnotify_animation;}if(r=="none"){k.show();s();}else{if(r=="show"){k.show(p.pnotify_animate_speed,s);}else{if(r=="fade"){k.show().fadeTo(p.pnotify_animate_speed,p.pnotify_opacity,s);}else{if(r=="slide"){k.slideDown(p.pnotify_animate_speed,s);}else{if(typeof r=="function"){r("in",s,k);}else{if(k.effect){k.effect(r,{},p.pnotify_animate_speed,s);}}}}}}};k.animate_out=function(s){l="out";var r;if(typeof p.pnotify_animation.effect_out!="undefined"){r=p.pnotify_animation.effect_out;}else{r=p.pnotify_animation;}if(r=="none"){k.hide();s();}else{if(r=="show"){k.hide(p.pnotify_animate_speed,s);}else{if(r=="fade"){k.fadeOut(p.pnotify_animate_speed,s);}else{if(r=="slide"){k.slideUp(p.pnotify_animate_speed,s);}else{if(typeof r=="function"){r("out",s,k);}else{if(k.effect){k.effect(r,{},p.pnotify_animate_speed,s);}}}}}}};k.pnotify_cancel_remove=function(){if(k.timer){window.clearTimeout(k.timer);}};k.pnotify_queue_remove=function(){k.pnotify_cancel_remove();k.timer=window.setTimeout(function(){k.pnotify_remove();},(isNaN(p.pnotify_delay)?0:p.pnotify_delay));};k.closer=d("<div />",{"class":"ui-pnotify-closer",css:{cursor:"pointer",display:"none"},click:function(){k.pnotify_remove();k.closer.hide();}}).append(d("<span />",{"class":"ui-icon ui-icon-circle-close"})).appendTo(k.container);k.title_container=d("<div />",{"class":"ui-pnotify-title",html:p.pnotify_title}).appendTo(k.container);if(p.pnotify_title===false){k.title_container.hide();}if(p.pnotify_insert_brs&&typeof p.pnotify_text=="string"){p.pnotify_text=p.pnotify_text.replace(/\n/g,"<br />");}k.text_container=d("<div />",{"class":"ui-pnotify-text",html:p.pnotify_text}).appendTo(k.container);if(p.pnotify_text===false){k.text_container.hide();}if(typeof p.pnotify_width=="string"){k.css("width",p.pnotify_width);}if(typeof p.pnotify_min_height=="string"){k.container.css("min-height",p.pnotify_min_height);}var o=e.data("pnotify");if(o==null||typeof o!="object"){o=[];}if(p.pnotify_stack.push=="top"){o=d.merge([k],o);}else{o=d.merge(o,[k]);}e.data("pnotify",o);if(p.pnotify_after_init){p.pnotify_after_init(k);}p.pnotify_stack.animation=false;k.pnotify_display();return k;}});var j=/^on/;var c=/^(dbl)?click$|^mouse(move|down|up|over|out|enter|leave)$|^contextmenu$/;var h=/^(focus|blur|select|change|reset)$|^key(press|down|up)$/;var g=/^(scroll|resize|(un)?load|abort|error)$/;var f=function(l,k){var m;l=l.toLowerCase();if(document.createEvent&&this.dispatchEvent){l=l.replace(j,"");if(l.match(c)){d(this).offset();m=document.createEvent("MouseEvents");m.initMouseEvent(l,k.bubbles,k.cancelable,k.view,k.detail,k.screenX,k.screenY,k.clientX,k.clientY,k.ctrlKey,k.altKey,k.shiftKey,k.metaKey,k.button,k.relatedTarget);}else{if(l.match(h)){m=document.createEvent("UIEvents");m.initUIEvent(l,k.bubbles,k.cancelable,k.view,k.detail);}else{if(l.match(g)){m=document.createEvent("HTMLEvents");m.initEvent(l,k.bubbles,k.cancelable);}}}if(!m){return;}this.dispatchEvent(m);}else{if(!l.match(j)){l="on"+l;}m=document.createEventObject(k);this.fireEvent(l,m);}};d.pnotify.defaults={pnotify_nonblock:false,pnotify_type:"notice",pnotify_opacity:1,pnotify_shadow:false,pnotify_closer:true,pnotify_delay:8000,pnotify_mouse_reset:true,pnotify_remove:true,pnotify_insert_brs:true,pnotify_stack:{dir1:"down",dir2:"left",push:"bottom"}};})(jQuery);(function(a){var b=function(p,z){var I={adaptivePadding:0.05,backendServer:"",enableAutoTitle:true,enableFullscreen:true,enableGotoPage:true,enableGrid:true,enableGridSlider:true,enableKeyScroll:true,enableSpaceScroll:false,enableZoomSlider:true,fixedPadding:10,iipServerBaseUrl:"",maxPagesPerRow:8,maxZoomLevel:0,minPagesPerRow:2,minZoomLevel:0,onFullscreen:null,onFullscreenEnter:null,onFullscreenExit:null,onJump:null,onReady:null,onScroll:null,onScrollDown:null,onScrollUp:null,onZoom:null,onZoomIn:null,onZoomOut:null,pagesPerRow:5,tileFadeSpeed:300,tileHeight:256,tileWidth:256,viewportMargin:200,zoomLevel:2};var ae=a.extend({},I,z);var l={centerX:0,centerY:0,currentPageIndex:0,dimAfterZoom:0,dimBeforeZoom:0,doubleClick:false,elementSelector:"",firstAjaxRequest:true,firstPageLoaded:-1,firstRowLoaded:-1,fullscreenStatusbar:null,goDirectlyTo:0,heightAbovePages:[],horizontalOffset:0,horizontalPadding:0,ID:null,inFullscreen:false,inGrid:false,itemTitle:"",lastPageLoaded:-1,lastRowLoaded:-1,maxHeight:0,maxWidth:0,mobileSafari:false,numPages:0,numRows:0,pages:[],panelHeight:0,panelWidth:0,prevVptTop:0,scaleWait:false,selector:"",scrollSoFar:0,totalHeight:0,verticalOffset:0,verticalPadding:0,viewerXOffset:0,viewerYOffset:0,zoomInCallback:null,zoomOutCallback:null};a.extend(ae,l);var O=function(am,aj){var ak=ae.panelHeight;var ai=ae.scrollSoFar-ae.viewportMargin;var al=ai+ak+ae.viewportMargin*2;if(am>=ai&&am<=al){return true;}else{if(aj>=ai&&aj<=al){return true;}else{if(am<=ai&&aj>=al){return true;}else{return false;}}}};var k=function(ai){if(a(ae.selector+"page-"+ai).length===0){return false;}else{return true;}};var Z=function(ai){var aj=ae.heightAbovePages[ai];var ak=aj+ae.pages[ai].h+ae.verticalPadding;return O(aj,ak);};var s=function(ai,ak,am){var aj=ae.heightAbovePages[ai]+(ak*ae.tileHeight)+ae.verticalPadding;var al=aj+ae.tileHeight;return O(aj,al);};var R=function(ai,aj){if(a(ae.selector+"tile-"+ai+"-"+aj).length>0){return true;}else{return false;}};var t=function(ay){var aD=[];var aE=ae.pages[ay].fn;var au=ae.pages[ay].r;var aw=ae.pages[ay].c;var aC=ae.pages[ay].w;var az=ae.pages[ay].h;var aB=ae.pages[ay].m_z;var av,ao;var aG,ak,aq,ap,ar,ai,aj;var aI=0;var am=ae.heightAbovePages[ay]+ae.verticalPadding;if(!k(ay)){aD.push('<div id="'+ae.ID+"page-"+ay+'" style="top: '+am+"px; width: "+aC+"px; height: "+az+"px; left: 50%; margin-left: -"+(aC/2)+'px" class="diva-page">');}aG=az-(au-1)*ae.tileHeight;ak=aC-(aw-1)*ae.tileWidth;var aH=[];for(aq=0;aq<au;aq++){for(ap=0;ap<aw;ap++){var ax=aq*ae.tileHeight;var an=ap*ae.tileWidth;var at=(ae.tileFadeSpeed)?"none":"inline";var aA=(aB===ae.maxZoomLevel)?ae.zoomLevel:ae.zoomLevel+(aB-ae.maxZoomLevel);ar=(aq===au-1)?aG:ae.tileHeight;ai=(ap===aw-1)?ak:ae.tileWidth;aj=ae.iipServerBaseUrl+aE+"&amp;JTL="+aA+","+aI;if(!R(ay,aI)&&s(ay,aq,ap)){aD.push('<div id="'+ae.ID+"tile-"+ay+"-"+aI+'"style="display: '+at+"; position: absolute; top: "+ax+"px; left: "+an+"px; background-image: url('"+aj+"'); height: "+ar+"px; width: "+ai+'px;"></div>');}aH.push(aI);aI++;}}if(!k(ay)){aD.push("</div>");var al=aD.join("");a(ae.innerSelector).append(al);}else{a(ae.selector+"page-"+ay).append(aD.join(""));}if(ae.tileFadeSpeed){for(var aF=0;aF<aH.length;aF++){a(ae.selector+"tile-"+ay+"-"+aH[aF]).fadeIn(ae.tileFadeSpeed);}}};var J=function(ai){if(k(ai)){a(ae.selector+"page-"+ai).remove();}};var n=function(ai){if(ai>=0&&ai<ae.numRows){return true;}else{return false;}};var T=function(ai){if(ai>=0&&ai<ae.numPages){return true;}else{return false;}};var V=function(aj){var ak=ae.heightAbovePages[aj]+ae.pages[aj].h+ae.verticalPadding;var ai=ae.scrollSoFar;if(ak<ai){return true;}else{return false;}};var d=function(ai){var aj=ae.heightAbovePages[ai];var ak=ae.scrollSoFar+ae.panelHeight;if(aj>ak){return true;}else{return false;}};var ab=function(ak){var aj=ae.rowHeight*(ak+1);var ai=ae.scrollSoFar;if(aj<ai){return true;}else{return false;}};var g=function(ak){var ai=ae.rowHeight*ak;var aj=ae.scrollSoFar+ae.panelHeight;if(ai>aj){return true;}else{return false;}};var Q=function(ai){var aj=ai+1;a.updateHashParam("p",""+aj);a(ae.selector+"current span").text(aj);if(ae.inFullscreen){if(ae.fullscreenStatusbar===null){h("fade");}ae.fullscreenStatusbar.pnotify({pnotify_title:"Page: "+aj});}};var w=function(am){var ak=ae.currentPageIndex;var ai=ae.currentPageIndex+parseInt(am,10);var al=ae.scrollSoFar+(ae.panelHeight/2);var aj=false;if(am<0){if(ai>=0&&(ae.heightAbovePages[ak]>=al||ae.heightAbovePages[ai]>=ae.scrollSoFar)){aj=true;}}else{if(am>0){if(ae.heightAbovePages[ak]+ae.pages[ak].h<ae.scrollSoFar&&ai<ae.pages.length){aj=true;}}}if(aj){ae.currentPageIndex=ai;if(am!==0){if(!w(am)){Q(ai);}}return true;}else{return false;}};var B=function(ai,aj){if(aj>0){if(T(ai)){if(Z(ai)){t(ai);ae.lastPageLoaded=ai;B(ae.lastPageLoaded+1,aj);}else{if(V(ai)){B(ai+1,aj);}}}else{return;}}else{if(T(ai)){if(Z(ai)){t(ai);ae.firstPageLoaded=ai;B(ae.firstPageLoaded-1,aj);}else{if(d(ai)){B(ai-1,aj);}}}else{return;}}};var K=function(ai,aj){if(aj>0){if(T(ai)&&V(ai)){J(ai);ae.firstPageLoaded++;K(ae.firstPageLoaded,aj);}else{return;}}else{if(T(ai)&&d(ai)){J(ai);ae.lastPageLoaded--;K(ae.lastPageLoaded,aj);}else{return;}}};var E=function(aj,ai){if(ai>0){if(n(aj)){if(X(aj)){j(aj);ae.lastRowLoaded=aj;E(ae.lastRowLoaded+1,ai);}else{if(ab(aj)){E(aj+1,ai);}}}}else{if(n(aj)){if(X(aj)){j(aj);ae.currentPageIndex=ae.firstRowLoaded*ae.pagesPerRow;Q(ae.currentPageIndex);ae.firstRowLoaded=aj;E(ae.firstRowLoaded-1,ai);}else{if(g(aj)){E(aj-1,ai);}}}}};var H=function(ai){if(N(ai)){a(ae.selector+"row-"+ai).remove();}};var P=function(aj,ai){if(ai>0){if(n(aj)&&ab(aj)){H(aj);ae.firstRowLoaded++;ae.currentPageIndex=ae.firstRowLoaded*ae.pagesPerRow;Q(ae.currentPageIndex);P(ae.firstRowLoaded,ai);}}else{if(n(aj)&&g(aj)){H(aj);ae.lastRowLoaded--;P(ae.lastRowLoaded,ai);}}};var L=function(ai){if(ai<0){E(ae.firstRowLoaded,-1);P(ae.lastRowLoaded,-1);}else{if(ai>0){P(ae.firstRowLoaded,1);E(ae.lastRowLoaded,1);}}};var v=function(ai){if(ai<0){B(ae.firstPageLoaded,ai);w(-1);K(ae.lastPageLoaded,ai);}else{if(ai>0){K(ae.firstPageLoaded,ai);B(ae.lastPageLoaded,ai);w(1);}}if(ai!==0){a.executeCallback(ae.onScroll,ae.currentPageIndex);if(ai>0){a.executeCallback(ae.onScrollDown,ae.currentPageIndex);}else{a.executeCallback(ae.onScrollUp,ae.currentPageIndex);}}};var af=function(){if(ae.goDirectlyTo){U(ae.goDirectlyTo);Q(ae.goDirectlyTo-1);ae.goDirectlyTo=0;return;}var am,al,ak,ai;var aj=(ae.dimBeforeZoom>0)?ae.dimAfterZoom/ae.dimBeforeZoom:1;if(ae.doubleClick){am=ae.centerX*aj;al=ae.centerY*aj;ak=Math.max((am)-(ae.panelWidth/2),0);ai=Math.max((al)-(ae.panelHeight/2),0);}else{ak=ae.maxWidth/2-ae.panelWidth/2+ae.horizontalPadding;ai=ae.verticalOffset*aj;}ae.prevVptTop=0;a(ae.outerSelector).scrollTop(ai);a(ae.outerSelector).scrollLeft(ak);};var i=function(aj,ai){a.ajax({url:ae.backendServer+="&z="+aj,cache:true,context:this,dataType:"json",success:function(ak){if(ae.firstAjaxRequest){m(ak,aj);}c();ae.pages=ak.pgs;ae.maxWidth=ak.dims.max_w;ae.maxHeight=ak.dims.max_h;a.executeCallback(ai,ak);ae.firstAjaxRequest=false;}});};var m=function(ai,aj){ae.itemTitle=ai.item_title;ae.numPages=ai.pgs.length;ae.maxZoomLevel=(ae.maxZoomLevel>0&&ae.maxZoomLevel<=ai.max_zoom)?ae.maxZoomLevel:ai.max_zoom;if(aj>ae.maxZoomLevel){aj=0;}a(ae.selector+"current label").text(ae.numPages);if(ae.enableAutoTitle){a(ae.elementSelector).prepend('<div id="'+ae.ID+'title">'+ae.itemTitle+"</div>");}};var N=function(ai){if(a(ae.selector+"row-"+ai).length>0){return true;}else{return false;}};var X=function(ak){var aj=ae.rowHeight*ak;var ai=aj+ae.rowHeight+ae.fixedPadding;return O(aj,ai);};var j=function(ao){if(N(ao)){return;}var an;var ai=(ae.rowHeight)*ao+ae.fixedPadding;var al=[];al.push('<div id="'+ae.ID+"row-"+ao+'" style="width: 100%; height: '+ae.rowHeight+"; position: absolute; top: "+ai+'px;">');for(an=0;an<ae.pagesPerRow;an++){var am=ao*ae.pagesPerRow+an;if(!T(am)){break;}var ap=am+1;var aj=ae.pages[am].fn;var aq=ae.iipServerBaseUrl+aj+"&amp;WID="+ae.gridPageWidth+"&amp;CVT=JPG";var ak=an*(ae.fixedPadding+ae.gridPageWidth)+ae.fixedPadding;al.push('<div id="'+ae.ID+"page-"+am+'" style="position: absolute; left: '+ak+"px; display: inline; background-image: url('"+aq+"'); background-repeat: no-repeat; width: "+ae.gridPageWidth+"px; height: "+ae.rowHeight+'px;"></div>');}a(ae.innerSelector).append(al.join(""));};var f=function(){i(0,function(ak){if(ae.enableGridSlider){C();}var al=ae.fixedPadding*(ae.pagesPerRow+1);var ai=(ae.panelWidth-al)/ae.pagesPerRow;ae.gridPageWidth=ai;ae.rowHeight=ae.fixedPadding+ak.dims.max_ratio*ai;ae.numRows=Math.ceil(ae.numPages/ae.pagesPerRow);ae.totalHeight=ae.numRows*ae.rowHeight+ae.fixedPadding;a(ae.innerSelector).css("height",Math.round(ae.totalHeight));a(ae.innerSelector).css("width",Math.round(ae.panelWidth));U(ae.currentPageIndex+1);ae.scrollSoFar=a(ae.outerSelector).scrollTop();for(var aj=0;aj<ae.numPages;aj+=ae.pagesPerRow){var am=Math.floor(aj/ae.pagesPerRow);if(X(am)){ae.firstRowLoaded=(ae.firstRowLoaded<0)?am:ae.firstRowLoaded;j(am);ae.lastRowLoaded=am;}}});};var c=function(){a(ae.outerSelector).scrollTop(0);ae.scrollSoFar=0;a(ae.innerSelector).text("");ae.firstPageLoaded=0;};var ah=function(ai){i(ai,function(am){if(ae.adaptivePadding>0){ae.horizontalPadding=am.dims.a_wid*ae.adaptivePadding;ae.verticalPadding=am.dims.a_hei*ae.adaptivePadding;}else{ae.horizontalPadding=ae.fixedPadding;ae.verticalPadding=ae.fixedPadding;}ae.totalHeight=am.dims.t_hei+ae.verticalPadding*(ae.numPages+1);ae.zoomLevel=ai;ae.dimAfterZoom=ae.totalHeight;if(ae.enableZoomSlider){M();}var aj=0;for(var ak=0;ak<ae.numPages;ak++){ae.heightAbovePages[ak]=aj;aj=ae.heightAbovePages[ak]+ae.pages[ak].h+ae.verticalPadding;if(Z(ak)){t(ak);ae.lastPageLoaded=ak;}}a(ae.innerSelector).css("height",Math.round(ae.totalHeight));var al=(am.dims.max_w+ae.horizontalPadding*2<ae.panelWidth)?ae.panelWidth:am.dims.max_w+ae.horizontalPadding*2;a(ae.innerSelector).css("width",Math.round(al));af();if(!ae.firstAjaxRequest){if(ae.dimBeforeZoom!==ae.dimAfterZoom){a.executeCallback(ae.onZoom,ai);if(ae.dimBeforeZoom>ae.dimAfterZoom){a.executeCallback(ae.onZoomOut,ai);a.executeCallback(ae.zoomOutCallback,ai);ae.zoomOutCallback=null;}else{a.executeCallback(ae.onZoomIn,ai);a.executeCallback(ae.zoomInCallback,ai);ae.zoomInCallback=null;}}else{a.executeCallback(ae.onFullscreen,ai);}}else{a.executeCallback(ae.onReady);}ae.dimBeforeZoom=ae.dimAfterZoom;if(ae.scaleWait){ae.scaleWait=false;}});};var aa=function(){ae.scrollSoFar=a(ae.outerSelector).scrollTop();v(ae.scrollSoFar-ae.prevVptTop);ae.prevVptTop=ae.scrollSoFar;};var ag=function(){ae.scrollSoFar=a(ae.outerSelector).scrollTop();L(ae.scrollSoFar-ae.prevVptTop);ae.prevVptTop=ae.scrollSoFar;};var D=function(ai){if(ae.zoomLevel!=ai&&ai>=ae.minZoomLevel&&ai<=ae.maxZoomLevel){ah(ai);a(ae.selector+"zoom-slider").slider({value:ai});a.updateHashParam("z",""+ai);return true;}else{a.executeCallback(ae.zoomInCallback,ae.zoomLevel);a.executeCallback(ae.zoomOutCallback,ae.zoomLevel);ae.zoomOutCallback=null;ae.zoomInCallback=null;return false;}};var Y=function(ai){ae.verticalOffset=a(ae.outerSelector).scrollTop();ae.horizontalOffset=a(ae.outerSelector).scrollLeft();if(ae.inGrid){e(true);}ae.doubleClick=false;D(ai);};var U=function(ai){if(ae.inGrid){var al=Math.ceil(ai/ae.pagesPerRow)-1;if(n(al)){var ak=al*ae.rowHeight;a(ae.outerSelector).scrollTop(ak);Q(ai-1);ae.currentPageIndex=ai-1;return true;}}else{pageIndex=ai-1;if(T(pageIndex)){var ak=ae.heightAbovePages[pageIndex];Q(pageIndex);a(ae.outerSelector).scrollTop(ak);var aj=(a(ae.innerSelector).width()-ae.panelWidth)/2;a(ae.outerSelector).scrollLeft(aj);a.executeCallback(ae.onJump,ai);return true;}}return false;};var F=function(aj){var ai;if(ae.zoomLevel===ae.maxZoomLevel){if(aj.ctrlKey){ai=ae.zoomLevel-1;}else{return;}}else{if(ae.zoomLevel===ae.minZoomLevel){if(aj.ctrlKey){return;}else{ai=ae.zoomLevel+1;}}else{if(aj.ctrlKey){ai=ae.zoomLevel-1;}else{ai=ae.zoomLevel+1;}}}ae.centerX=(aj.pageX-ae.viewerXOffset)+a(ae.outerSelector).scrollLeft();ae.centerY=(aj.pageY-ae.viewerYOffset)+a(ae.outerSelector).scrollTop();ae.doubleClick=true;D(ai);};var y=function(ai){ai.preventDefault();};var G=function(aj){var ai=ae.zoomLevel;if(aj.scale>1&&ai<ae.maxZoomLevel){ai++;}else{if(aj.scale<1&&ai>ae.minZoomLevel){ai--;}else{return;}}ae.scaleWait=true;Y(ai);};var r=function(){ae.verticalOffset=a(ae.outerSelector).scrollTop();ae.horizontalOffset=a(ae.outerSelector).scrollLeft();ae.doubleClick=false;a(ae.innerSelector).text("");if(ae.inFullscreen){S();a.updateHashParam("fullscreen","false");}else{ac();a.updateHashParam("fullscreen","true");}ae.panelWidth=parseInt(a(ae.outerSelector).width(),10)-20;ae.panelHeight=parseInt(a(ae.outerSelector).height(),10);a(ae.innerSelector).width(ae.panelWidth);if(ae.inGrid){f();}else{ah(ae.zoomLevel);}};var ac=function(){if(ae.fullscreenStatusbar==null){h("none");}a(ae.selector+"fullscreen").css("position","fixed").css("z-index","9001");a(ae.outerSelector).addClass("fullscreen");ae.inFullscreen=true;a("body").css("overflow","hidden");a.executeCallback(ae.onFullscreenEnter);};var S=function(){if(ae.fullscreenStatusbar!=null){ae.fullscreenStatusbar.pnotify({pnotify_animation:"none"});ae.fullscreenStatusbar.pnotify_remove();ae.fullscreenStatusbar=null;}a(ae.outerSelector).removeClass("fullscreen");ae.inFullscreen=false;a(ae.selector+"fullscreen").css("position","absolute").css("z-index","8999");a.executeCallback(ae.onFullscreenExit);};var u=function(){if(ae.inGrid){e();}else{x();}};var x=function(){ae.inGrid=true;f();a.updateHashParam("grid","true");};var e=function(ai){ae.inGrid=false;if(!ae.goDirectlyTo){ae.goDirectlyTo=ae.currentPageIndex+1;}if(!ai){ah(ae.zoomLevel);}a.updateHashParam("grid","false");};var A=function(){if(ae.enableGrid){a(ae.selector+"grid-icon").click(function(){u();});}if(ae.enableFullscreen){a(ae.selector+"fullscreen").click(function(){r();});var aj;a(window).resize(function(){clearTimeout(aj);aj=setTimeout(function(){ae.panelHeight=parseInt(a(ae.outerSelector).height(),10);v(1);var an=a("body").css("width");a(ae.innerSelector).css("width",an);},10);});}a(ae.innerSelector).mouseover(function(){a(this).removeClass("grabbing").addClass("grab");});a(ae.innerSelector).mouseout(function(){a(this).removeClass("grab");});a(ae.innerSelector).mousedown(function(){a(this).removeClass("grab").addClass("grabbing");});a(ae.innerSelector).mouseup(function(){a(this).removeClass("grabbing").addClass("grab");});a(ae.outerSelector+", "+ae.innerSelector).dragscrollable({dragSelector:".dragger",acceptPropagatedEvent:true});a(ae.outerSelector).scroll(function(){if(ae.inGrid){ag();}else{aa();}});a(ae.outerSelector).dblclick(function(ap){ae.viewerXOffset=this.offsetLeft;ae.viewerYOffset=this.offsetTop;if(ae.inGrid){var ar=(ap.pageX-ae.viewerXOffset)+a(ae.outerSelector).scrollLeft();var aq=(ap.pageY-ae.viewerYOffset)+a(ae.outerSelector).scrollTop();var at=Math.floor(aq/ae.rowHeight);var ao=Math.floor(ar/(ae.panelWidth/ae.pagesPerRow));var an=at*ae.pagesPerRow+ao+1;ae.goDirectlyTo=an;e();}else{F(ap);}});a(ae.outerSelector).bind("contextmenu",function(an){var ao=an.originalEvent;if(ao.ctrlKey){ao.preventDefault();ao.stopPropagation();}});if(ae.mobileSafari){a(ae.outerSelector).oneFingerScroll();var ak=[];ak.push('<meta name="viewport" content="user-scalable=no, width=device-width" />');ak.push('<meta name="apple-mobile-web-app-capable" content="yes" />');ak.push('<meta name="apple-mobile-web-app-status-bar-style" content="black" />');a("head").append(ak.join("\n"));a("body").bind("touchmove",function(an){var ao=an.originalEvent;y(ao);});a("body").bind("gestureend",function(an){var ao=an.originalEvent;if(!ae.scaleWait){if(ae.inGrid){e();}else{G(ao);}}return false;});}if(ae.enableSpaceScroll||ae.enableKeyScroll){var al=a.ui.keyCode.SPACE;var ai=a.ui.keyCode.PAGE_UP;var am=a.ui.keyCode.PAGE_DOWN;a(document).keydown(function(an){if((ae.enableSpaceScroll&&an.keyCode==al)||(ae.enableKeyScroll&&an.keyCode==am)){a(ae.outerSelector).scrollTop(ae.scrollSoFar+ae.panelHeight);return false;}if(ae.enableKeyScroll&&an.keyCode==ai){a(ae.outerSelector).scrollTop(ae.scrollSoFar-ae.panelHeight);return false;}});}};var h=function(aj){var ai={pnotify_text:'<form id="'+ae.ID+'goto-page-fullscreen"><input placeholder="'+ae.numPages+'" type="text" size="4" id="'+ae.ID+'goto-input-fullscreen" /><input type="submit" value="Go"></form>',pnotify_title:"Page: "+(ae.currentPageIndex+1),pnotify_history:false,pnotify_width:"110px",pnotify_hide:false,pnotify_notice_icon:"",pnotify_animation:aj,pnotify_before_close:function(){ae.fullscreenStatusbar=null;}};ae.fullscreenStatusbar=a.pnotify(ai);a(ae.selector+"goto-page-fullscreen").submit(function(){var ak=parseInt(a(ae.selector+"goto-input-fullscreen").val(),10);if(!U(ak)){alert("Invalid page number");}return false;});};var M=function(){a(ae.selector+"slider").remove();a(ae.selector+"slider-label").remove();a(ae.selector+"tools").prepend('<div id="'+ae.ID+'slider"></div>');a(ae.selector+"slider").slider({value:ae.zoomLevel,min:ae.minZoomLevel,max:ae.maxZoomLevel,step:1,slide:function(ai,aj){Y(aj.value);}});a(ae.selector+"slider").after('<div id="'+ae.ID+'slider-label">Zoom level: <span>'+ae.zoomLevel+"</span></div>");};var C=function(){a(ae.selector+"slider").remove();a(ae.selector+"slider-label").remove();a(ae.selector+"tools").prepend('<div id="'+ae.ID+'slider"></div>');a(ae.selector+"slider").slider({value:ae.pagesPerRow,min:ae.minPagesPerRow,max:ae.maxPagesPerRow,step:1,slide:function(ai,aj){q(aj.value);}});a(ae.selector+"slider").after('<div id="'+ae.ID+'slider-label">Pages per row: <span>'+ae.pagesPerRow+"</span></div>");};var q=function(ai){ae.pagesPerRow=ai;x();};var W=function(){a(ae.selector+"tools").prepend('<div id="'+ae.ID+'grid-icon"></div>');};var o=function(){a(ae.selector+"tools").append('<form id="'+ae.ID+'goto-page">Go to page <input type="text" size="3" id="'+ae.ID+'goto-input" /> <input type="submit" value="Go" /><br /><div id="'+ae.ID+'current">Current page: <span>1</span> of <label></label></div></form>');a(ae.selector+"goto-page").submit(function(){var ai=parseInt(a(ae.selector+"goto-input").val(),10);if(!U(ai)){alert("Invalid page number");}return false;});};var ad=function(){ae.mobileSafari=navigator.platform=="iPad"||navigator.platform=="iPhone"||navigator.platform=="iPod";ae.elementSelector="#"+a(p).attr("id");ae.ID=a.generateId("diva-");ae.selector="#"+ae.ID;ae.outerSelector=ae.selector+"outer";ae.innerSelector=ae.selector+"inner";if(ae.zoomSlider||ae.enableGotoPage||ae.enableGrid){a(ae.elementSelector).prepend('<div id="'+ae.ID+'tools"></div>');}if(ae.enableGotoPage){o();}if(ae.enableGrid){W();}a(ae.elementSelector).append('<div id="'+ae.ID+'outer"></div>');a(ae.outerSelector).append('<div id="'+ae.ID+'inner" class="dragger"></div>');if(ae.mobileSafari){ae.panelWidth=screen.width-20;if(navigator.platform=="iPad"){ae.panelHeight=screen.height-170;}else{ae.panelHeight=screen.height-250;}a(ae.elementSelector).css("width",ae.panelWidth);a(ae.outerSelector).css("width",ae.panelWidth+"px");a(ae.outerSelector).css("height",ae.panelHeight+"px");}else{ae.panelWidth=parseInt(a(ae.elementSelector).width(),10)-18;a(ae.outerSelector).css("width",(ae.panelWidth+18)+"px");ae.panelHeight=parseInt(a(ae.outerSelector).height(),10);}if(ae.enableFullscreen){a(ae.elementSelector).prepend('<div id="'+ae.ID+'fullscreen"></div>');}var al=a.getHashParam("z");if(al){ae.zoomLevel=Math.abs(parseInt(al,10));}var ak=a.getHashParam("p");if(ak){ae.goDirectlyTo=parseInt(ak,10);}var aj=a.getHashParam("fullscreen");if(aj==="true"&&ae.enableFullscreen){r();}var ai=a.getHashParam("grid");if(ai==="true"&&ae.enableGrid){u();}if(!ae.inFullscreen&&!ae.inGrid){ah(ae.zoomLevel);}A();};ad();this.getItemTitle=function(){return ae.itemTitle;};this.gotoPage=function(ai){return U(ai);};this.getCurrentPage=function(){return ae.currentPageIndex;};this.getZoomLevel=function(){return ae.zoomLevel;};this.zoomIn=function(ai){ae.zoomInCallback=ai;return D(ae.zoomLevel+1);};this.zoomOut=function(ai){ae.zoomOutCallback=ai;return D(ae.zoomLevel-1);};this.inViewport=function(ak,am,aj){var ai=ak-1;var an=ae.heightAbovePages[ai]+am;var al=an+aj;return O(an,al);};};a.fn.diva=function(c){return this.each(function(){var e=a(this);if(e.data("diva")){return;}var d=new b(this,c);e.data("diva",d);});};})(jQuery);