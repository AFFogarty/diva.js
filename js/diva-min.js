(function(b){var a=1;b.generateId=function(d){var c;do{c=(a++)+(d?"-"+d:"");}while(document.getElementById(c));return c;};})(jQuery);(function(a){a.executeCallback=function(c,b){if(typeof c=="function"){c.call(this,b);return true;}else{return false;}};})(jQuery);(function(a){a.getHashParam=function(b){var d=window.location.hash;if(d!=""){var e=(d.indexOf("&"+b+"=")>0)?d.indexOf("&"+b+"="):d.indexOf("#"+b+"=");if(e>=0){e+=b.length+2;var c=d.indexOf("&",e);if(c>e){return d.substring(e,c);}else{if(c<0){return d.substring(e);}}return"";}else{return false;}}else{return false;}};})(jQuery);(function(a){a.updateHashParam=function(c,e){var b=a.getHashParam(c);var f=window.location.hash;if(b!==e){if(typeof b=="string"){var h=(f.indexOf("&"+c+"=")>0)?f.indexOf("&"+c+"="):f.indexOf("#"+c+"=");var d=h+c.length+2+b.length;var g=(h==0)?"#":"&";window.location.replace(f.substring(0,h)+g+c+"="+e+f.substring(d));}else{if(f.length===0){window.location.replace("#"+c+"="+e);}else{window.location.replace(f+"&"+c+"="+e);}}}};})(jQuery);jQuery.fn.oneFingerScroll=function(){var c=0;var a;var b;$(this).bind("touchstart",function(d){var f=d.originalEvent;a=$(this).scrollTop()+f.touches[0].pageY;b=$(this).scrollLeft()+f.touches[0].pageX;f.preventDefault();});$(this).bind("touchmove",function(d){var f=d.originalEvent;$(this).scrollTop(a-f.touches[0].pageY);$(this).scrollLeft(b-f.touches[0].pageX);f.preventDefault();});return this;};(function(a){a.fn.dragscrollable=function(b){var d=a.extend({dragSelector:">:first",acceptPropagatedEvent:true,preventDefault:true},b||{});var c={mouseDownHandler:function(e){if(e.which!=1||(!e.data.acceptPropagatedEvent&&e.target!=this)){return false;}e.data.lastCoord={left:e.clientX,top:e.clientY};a.event.add(document,"mouseup",c.mouseUpHandler,e.data);a.event.add(document,"mousemove",c.mouseMoveHandler,e.data);if(e.data.preventDefault){e.preventDefault();return false;}},mouseMoveHandler:function(e){var f={left:(e.clientX-e.data.lastCoord.left),top:(e.clientY-e.data.lastCoord.top)};e.data.scrollable.scrollLeft(e.data.scrollable.scrollLeft()-f.left);e.data.scrollable.scrollTop(e.data.scrollable.scrollTop()-f.top);e.data.lastCoord={left:e.clientX,top:e.clientY};if(e.data.preventDefault){e.preventDefault();return false;}},mouseUpHandler:function(e){a.event.remove(document,"mousemove",c.mouseMoveHandler);a.event.remove(document,"mouseup",c.mouseUpHandler);if(e.data.preventDefault){e.preventDefault();return false;}}};this.each(function(){var e={scrollable:a(this),acceptPropagatedEvent:d.acceptPropagatedEvent,preventDefault:d.preventDefault};a(this).find(d.dragSelector).bind("mousedown",e,c.mouseDownHandler);});};})(jQuery);(function(d){var i,a;var e;var b;d.extend({pnotify_remove_all:function(){var k=e.data("pnotify");if(k&&k.length){d.each(k,function(){if(this.pnotify_remove){this.pnotify_remove();}});}},pnotify:function(n){if(!e){e=d("body");}if(!b){b=d(window);}var l;var p;if(typeof n!="object"){p=d.extend({},d.pnotify.defaults);p.pnotify_text=n;}else{p=d.extend({},d.pnotify.defaults,n);}if(p.pnotify_before_init){if(p.pnotify_before_init(p)===false){return null;}}var q;var m=function(v,s){k.css("display","none");var r=document.elementFromPoint(v.clientX,v.clientY);k.css("display","block");var u=d(r);var t=u.css("cursor");k.css("cursor",t!="auto"?t:"default");if(!q||q.get(0)!=r){if(q){f.call(q.get(0),"mouseleave",v.originalEvent);f.call(q.get(0),"mouseout",v.originalEvent);}f.call(r,"mouseenter",v.originalEvent);f.call(r,"mouseover",v.originalEvent);}f.call(r,s,v.originalEvent);q=u;};var k=d("<div />",{"class":"ui-pnotify "+p.pnotify_addclass,css:{display:"none"},mouseenter:function(r){if(p.pnotify_nonblock){r.stopPropagation();}if(p.pnotify_mouse_reset&&l=="out"){k.stop(true);l="in";k.css("height","auto").animate({width:p.pnotify_width,opacity:p.pnotify_nonblock?p.pnotify_nonblock_opacity:p.pnotify_opacity},"fast");}if(p.pnotify_nonblock){k.animate({opacity:p.pnotify_nonblock_opacity},"fast");}if(p.pnotify_hide&&p.pnotify_mouse_reset){k.pnotify_cancel_remove();}if(p.pnotify_closer&&!p.pnotify_nonblock){k.closer.show();}},mouseleave:function(r){if(p.pnotify_nonblock){r.stopPropagation();}q=null;k.css("cursor","auto");if(p.pnotify_nonblock&&l!="out"){k.animate({opacity:p.pnotify_opacity},"fast");}if(p.pnotify_hide&&p.pnotify_mouse_reset){k.pnotify_queue_remove();}k.closer.hide();d.pnotify_position_all();},mouseover:function(r){if(p.pnotify_nonblock){r.stopPropagation();}},mouseout:function(r){if(p.pnotify_nonblock){r.stopPropagation();}},mousemove:function(r){if(p.pnotify_nonblock){r.stopPropagation();m(r,"onmousemove");}},mousedown:function(r){if(p.pnotify_nonblock){r.stopPropagation();r.preventDefault();m(r,"onmousedown");}},mouseup:function(r){if(p.pnotify_nonblock){r.stopPropagation();r.preventDefault();m(r,"onmouseup");}},click:function(r){if(p.pnotify_nonblock){r.stopPropagation();m(r,"onclick");}},dblclick:function(r){if(p.pnotify_nonblock){r.stopPropagation();m(r,"ondblclick");}}});k.opts=p;if(p.pnotify_shadow&&!d.browser.msie){k.shadow_container=d("<div />",{"class":"ui-widget-shadow ui-corner-all ui-pnotify-shadow"}).prependTo(k);}k.container=d("<div />",{"class":"ui-widget ui-widget-content ui-corner-all ui-pnotify-container "+(p.pnotify_type=="error"?"ui-state-error":"ui-state-highlight")}).appendTo(k);k.pnotify_version="1.0.1";k.pnotify=function(r){var s=p;if(typeof r=="string"){p.pnotify_text=r;}else{p=d.extend({},p,r);}k.opts=p;if(p.pnotify_shadow!=s.pnotify_shadow){if(p.pnotify_shadow&&!d.browser.msie){k.shadow_container=d("<div />",{"class":"ui-widget-shadow ui-pnotify-shadow"}).prependTo(k);}else{k.children(".ui-pnotify-shadow").remove();}}if(p.pnotify_addclass===false){k.removeClass(s.pnotify_addclass);}else{if(p.pnotify_addclass!==s.pnotify_addclass){k.removeClass(s.pnotify_addclass).addClass(p.pnotify_addclass);}}if(p.pnotify_title===false){k.title_container.hide("fast");}else{if(p.pnotify_title!==s.pnotify_title){k.title_container.html(p.pnotify_title).show(200);}}if(p.pnotify_text===false){k.text_container.hide("fast");}else{if(p.pnotify_text!==s.pnotify_text){if(p.pnotify_insert_brs){p.pnotify_text=p.pnotify_text.replace(/\n/g,"<br />");}k.text_container.html(p.pnotify_text).show(200);}}if(p.pnotify_width!==s.pnotify_width){k.animate({width:p.pnotify_width});}if(p.pnotify_min_height!==s.pnotify_min_height){k.container.animate({minHeight:p.pnotify_min_height});}if(p.pnotify_opacity!==s.pnotify_opacity){k.fadeTo(p.pnotify_animate_speed,p.pnotify_opacity);}if(!p.pnotify_hide){k.pnotify_cancel_remove();}else{if(!s.pnotify_hide){k.pnotify_queue_remove();}}k.pnotify_queue_position();return k;};k.pnotify_queue_position=function(){if(a){clearTimeout(a);}a=setTimeout(d.pnotify_position_all,10);};k.pnotify_display=function(){if(!k.parent().length){k.appendTo(e);}if(p.pnotify_before_open){if(p.pnotify_before_open(k)===false){return;}}k.pnotify_queue_position();if(p.pnotify_animation=="fade"||p.pnotify_animation.effect_in=="fade"){k.show().fadeTo(0,0).hide();}else{if(p.pnotify_opacity!=1){k.show().fadeTo(0,p.pnotify_opacity).hide();}}k.animate_in(function(){if(p.pnotify_after_open){p.pnotify_after_open(k);}k.pnotify_queue_position();if(p.pnotify_hide){k.pnotify_queue_remove();}});};k.pnotify_remove=function(){if(k.timer){window.clearTimeout(k.timer);k.timer=null;}if(p.pnotify_before_close){if(p.pnotify_before_close(k)===false){return;}}k.animate_out(function(){if(p.pnotify_after_close){if(p.pnotify_after_close(k)===false){return;}}k.pnotify_queue_position();if(p.pnotify_remove){k.detach();}});};k.animate_in=function(s){l="in";var r;if(typeof p.pnotify_animation.effect_in!="undefined"){r=p.pnotify_animation.effect_in;}else{r=p.pnotify_animation;}if(r=="none"){k.show();s();}else{if(r=="show"){k.show(p.pnotify_animate_speed,s);}else{if(r=="fade"){k.show().fadeTo(p.pnotify_animate_speed,p.pnotify_opacity,s);}else{if(r=="slide"){k.slideDown(p.pnotify_animate_speed,s);}else{if(typeof r=="function"){r("in",s,k);}else{if(k.effect){k.effect(r,{},p.pnotify_animate_speed,s);}}}}}}};k.animate_out=function(s){l="out";var r;if(typeof p.pnotify_animation.effect_out!="undefined"){r=p.pnotify_animation.effect_out;}else{r=p.pnotify_animation;}if(r=="none"){k.hide();s();}else{if(r=="show"){k.hide(p.pnotify_animate_speed,s);}else{if(r=="fade"){k.fadeOut(p.pnotify_animate_speed,s);}else{if(r=="slide"){k.slideUp(p.pnotify_animate_speed,s);}else{if(typeof r=="function"){r("out",s,k);}else{if(k.effect){k.effect(r,{},p.pnotify_animate_speed,s);}}}}}}};k.pnotify_cancel_remove=function(){if(k.timer){window.clearTimeout(k.timer);}};k.pnotify_queue_remove=function(){k.pnotify_cancel_remove();k.timer=window.setTimeout(function(){k.pnotify_remove();},(isNaN(p.pnotify_delay)?0:p.pnotify_delay));};k.closer=d("<div />",{"class":"ui-pnotify-closer",css:{cursor:"pointer",display:"none"},click:function(){k.pnotify_remove();k.closer.hide();}}).append(d("<span />",{"class":"ui-icon ui-icon-circle-close"})).appendTo(k.container);k.title_container=d("<div />",{"class":"ui-pnotify-title",html:p.pnotify_title}).appendTo(k.container);if(p.pnotify_title===false){k.title_container.hide();}if(p.pnotify_insert_brs&&typeof p.pnotify_text=="string"){p.pnotify_text=p.pnotify_text.replace(/\n/g,"<br />");}k.text_container=d("<div />",{"class":"ui-pnotify-text",html:p.pnotify_text}).appendTo(k.container);if(p.pnotify_text===false){k.text_container.hide();}if(typeof p.pnotify_width=="string"){k.css("width",p.pnotify_width);}if(typeof p.pnotify_min_height=="string"){k.container.css("min-height",p.pnotify_min_height);}var o=e.data("pnotify");if(o==null||typeof o!="object"){o=[];}if(p.pnotify_stack.push=="top"){o=d.merge([k],o);}else{o=d.merge(o,[k]);}e.data("pnotify",o);if(p.pnotify_after_init){p.pnotify_after_init(k);}p.pnotify_stack.animation=false;k.pnotify_display();return k;}});var j=/^on/;var c=/^(dbl)?click$|^mouse(move|down|up|over|out|enter|leave)$|^contextmenu$/;var h=/^(focus|blur|select|change|reset)$|^key(press|down|up)$/;var g=/^(scroll|resize|(un)?load|abort|error)$/;var f=function(l,k){var m;l=l.toLowerCase();if(document.createEvent&&this.dispatchEvent){l=l.replace(j,"");if(l.match(c)){d(this).offset();m=document.createEvent("MouseEvents");m.initMouseEvent(l,k.bubbles,k.cancelable,k.view,k.detail,k.screenX,k.screenY,k.clientX,k.clientY,k.ctrlKey,k.altKey,k.shiftKey,k.metaKey,k.button,k.relatedTarget);}else{if(l.match(h)){m=document.createEvent("UIEvents");m.initUIEvent(l,k.bubbles,k.cancelable,k.view,k.detail);}else{if(l.match(g)){m=document.createEvent("HTMLEvents");m.initEvent(l,k.bubbles,k.cancelable);}}}if(!m){return;}this.dispatchEvent(m);}else{if(!l.match(j)){l="on"+l;}m=document.createEventObject(k);this.fireEvent(l,m);}};d.pnotify.defaults={pnotify_nonblock:false,pnotify_type:"notice",pnotify_opacity:1,pnotify_shadow:false,pnotify_closer:true,pnotify_delay:8000,pnotify_mouse_reset:true,pnotify_remove:true,pnotify_insert_brs:true,pnotify_stack:{dir1:"down",dir2:"left",push:"bottom"}};})(jQuery);(function(a){var b=function(r,D){var M={adaptivePadding:0.05,backendServer:"",enableAutoTitle:true,enableFilename:true,enableFullscreen:true,enableGotoPage:true,enableGrid:true,enableGridSlider:true,enableKeyScroll:true,enableSpaceScroll:false,enableZoomSlider:true,fixedPadding:10,iipServerBaseUrl:"",maxPagesPerRow:8,maxZoomLevel:0,minPagesPerRow:2,minZoomLevel:0,onFullscreen:null,onFullscreenEnter:null,onFullscreenExit:null,onJump:null,onReady:null,onScroll:null,onScrollDown:null,onScrollUp:null,onZoom:null,onZoomIn:null,onZoomOut:null,pagesPerRow:5,tileFadeSpeed:300,tileHeight:256,tileWidth:256,viewportMargin:200,zoomLevel:2};var ai=a.extend({},M,D);var n={centerX:0,centerY:0,currentPageIndex:0,desiredXOffset:0,desiredYOfffset:0,dimAfterZoom:0,dimBeforeZoom:0,doubleClick:false,elementSelector:"",firstAjaxRequest:true,firstPageLoaded:-1,firstRowLoaded:-1,fullscreenStatusbar:null,goDirectlyTo:-1,hashParamSuffix:"",heightAbovePages:[],horizontalOffset:0,horizontalPadding:0,ID:null,inFullscreen:false,inGrid:false,itemTitle:"",lastPageLoaded:-1,lastRowLoaded:-1,maxHeight:0,maxWidth:0,mobileSafari:false,numPages:0,numRows:0,pages:[],panelHeight:0,panelWidth:0,prevVptTop:0,scaleWait:false,selector:"",scrollSoFar:0,totalHeight:0,verticalOffset:0,verticalPadding:0,viewerXOffset:0,viewerYOffset:0,zoomInCallback:null,zoomOutCallback:null};a.extend(ai,n);var S=function(at,ap){var aq=ai.panelHeight;var ao=ai.scrollSoFar-ai.viewportMargin;var ar=ao+aq+ai.viewportMargin*2;if(at>=ao&&at<=ar){return true;}else{if(ap>=ao&&ap<=ar){return true;}else{if(at<=ao&&ap>=ar){return true;}else{return false;}}}};var l=function(ao){if(a(ai.selector+"page-"+ao).length===0){return false;}else{return true;}};var ad=function(ao){var ap=ai.heightAbovePages[ao];var aq=ap+ai.pages[ao].h+ai.verticalPadding;return S(ap,aq);};var v=function(ao,aq,at){var ap=ai.heightAbovePages[ao]+(aq*ai.tileHeight)+ai.verticalPadding;var ar=ap+ai.tileHeight;return S(ap,ar);};var V=function(ao,ap){if(a(ai.selector+"tile-"+ao+"-"+ap).length>0){return true;}else{return false;}};var w=function(aE){var aJ=[];var aK=ai.pages[aE].fn;var aA=ai.pages[aE].r;var aC=ai.pages[aE].c;var aI=ai.pages[aE].w;var aF=ai.pages[aE].h;var aH=ai.pages[aE].m_z;var aB,av;var aM,aq,ax,aw,ay,ao,ap;var aO=0;var at=ai.heightAbovePages[aE]+ai.verticalPadding;if(!l(aE)){aJ.push('<div id="'+ai.ID+"page-"+aE+'" style="top: '+at+"px; width: "+aI+"px; height: "+aF+"px; left: 50%; margin-left: -"+(aI/2)+'px" class="diva-page">');}aM=aF-(aA-1)*ai.tileHeight;aq=aI-(aC-1)*ai.tileWidth;var aN=[];for(ax=0;ax<aA;ax++){for(aw=0;aw<aC;aw++){var aD=ax*ai.tileHeight;var au=aw*ai.tileWidth;var az=(ai.tileFadeSpeed)?"none":"inline";var aG=(aH===ai.maxZoomLevel)?ai.zoomLevel:ai.zoomLevel+(aH-ai.maxZoomLevel);ay=(ax===aA-1)?aM:ai.tileHeight;ao=(aw===aC-1)?aq:ai.tileWidth;ap=ai.iipServerBaseUrl+aK+"&amp;JTL="+aG+","+aO;if(!V(aE,aO)&&v(aE,ax,aw)){aJ.push('<div id="'+ai.ID+"tile-"+aE+"-"+aO+'"style="display: '+az+"; position: absolute; top: "+aD+"px; left: "+au+"px; background-image: url('"+ap+"'); height: "+ay+"px; width: "+ao+'px;"></div>');}aN.push(aO);aO++;}}if(!l(aE)){aJ.push("</div>");var ar=aJ.join("");a(ai.innerSelector).append(ar);}else{a(ai.selector+"page-"+aE).append(aJ.join(""));}if(ai.tileFadeSpeed){for(var aL=0;aL<aN.length;aL++){a(ai.selector+"tile-"+aE+"-"+aN[aL]).fadeIn(ai.tileFadeSpeed);}}};var N=function(ao){if(l(ao)){a(ai.selector+"page-"+ao).remove();}};var p=function(ao){if(ao>=0&&ao<ai.numRows){return true;}else{return false;}};var X=function(ao){if(ao>=0&&ao<ai.numPages){return true;}else{return false;}};var Z=function(ap){var aq=ai.heightAbovePages[ap]+ai.pages[ap].h+ai.verticalPadding;var ao=ai.scrollSoFar;if(aq<ao){return true;}else{return false;}};var d=function(ao){var ap=ai.heightAbovePages[ao];var aq=ai.scrollSoFar+ai.panelHeight;if(ap>aq){return true;}else{return false;}};var af=function(aq){var ap=ai.rowHeight*(aq+1);var ao=ai.scrollSoFar;if(ap<ao){return true;}else{return false;}};var g=function(aq){var ao=ai.rowHeight*aq;var ap=ai.scrollSoFar+ai.panelHeight;if(ao>ap){return true;}else{return false;}};var U=function(ao){var ap=ao+1;a(ai.selector+"current span").text(ap);if(ai.inFullscreen){if(ai.fullscreenStatusbar===null){h("fade");}a(ai.selector+"page-number-fullscreen").text(ap);}};var z=function(ar){var aq=ai.currentPageIndex;var ao=ai.currentPageIndex+parseInt(ar,10);var ap=false;if(ar<0){if(ao>=0&&(ai.heightAbovePages[ao]+ai.pages[ao].h+(ai.verticalPadding)>=ai.scrollSoFar)){ap=true;}}else{if(ar>0){if(ai.heightAbovePages[aq]+ai.pages[aq].h+ai.verticalPadding<ai.scrollSoFar){ap=true;}}}if(ap){ai.currentPageIndex=ao;if(ar!==0){if(!z(ar)){U(ao);}}return true;}else{return false;}};var u=function(ar){var ao=Math.floor(ai.currentPageIndex/ai.pagesPerRow);var aq=ao+parseInt(ar,10);var ap=ai.scrollSoFar+(ai.panelHeight/2);var at=false;if(ar<0){if(aq>=0&&(ai.rowHeight*ao>=ap||ai.rowHeight*aq>=ai.scrollSoFar)){at=true;}}else{if(ar>0){if((ai.rowHeight*(ao+1))<ai.scrollSoFar&&p(aq)){at=true;}}}if(at){ai.currentPageIndex=aq*ai.pagesPerRow;if(ar!==0){if(!u(ar)){U(ai.currentPageIndex);}}return true;}else{return false;}};var F=function(ao,ap){if(ap>0){if(X(ao)){if(ad(ao)){w(ao);ai.lastPageLoaded=ao;F(ai.lastPageLoaded+1,ap);}else{if(Z(ao)){F(ao+1,ap);}}}else{return;}}else{if(X(ao)){if(ad(ao)){w(ao);ai.firstPageLoaded=ao;F(ai.firstPageLoaded-1,ap);}else{if(d(ao)){F(ao-1,ap);}}}else{return;}}};var O=function(ao,ap){if(ap>0){if(X(ao)&&Z(ao)){N(ao);ai.firstPageLoaded++;O(ai.firstPageLoaded,ap);}else{return;}}else{if(X(ao)&&d(ao)){N(ao);ai.lastPageLoaded--;O(ai.lastPageLoaded,ap);}else{return;}}};var I=function(ap,ao){if(ao>0){if(p(ap)){if(ab(ap)){k(ap);ai.lastRowLoaded=ap;I(ai.lastRowLoaded+1,ao);}else{if(af(ap)){I(ap+1,ao);}}}}else{if(p(ap)){if(ab(ap)){k(ap);ai.firstRowLoaded=ap;I(ai.firstRowLoaded-1,ao);}else{if(g(ap)){I(ap-1,ao);}}}}};var L=function(ao){if(R(ao)){a(ai.selector+"row-"+ao).remove();}};var T=function(ap,ao){if(ao>0){if(p(ap)&&af(ap)){L(ap);ai.firstRowLoaded++;T(ai.firstRowLoaded,ao);}}else{if(p(ap)&&g(ap)){L(ap);ai.lastRowLoaded--;T(ai.lastRowLoaded,ao);}}};var P=function(ao){if(ao<0){I(ai.firstRowLoaded,-1);u(-1);T(ai.lastRowLoaded,-1);}else{if(ao>0){T(ai.firstRowLoaded,1);u(1);I(ai.lastRowLoaded,1);}}};var y=function(ao){if(ao<0){F(ai.firstPageLoaded,ao);z(-1);O(ai.lastPageLoaded,ao);}else{if(ao>0){O(ai.firstPageLoaded,ao);F(ai.lastPageLoaded,ao);z(1);}}if(ao!==0){a.executeCallback(ai.onScroll,ai.currentPageIndex);if(ao>0){a.executeCallback(ai.onScrollDown,ai.currentPageIndex);}else{a.executeCallback(ai.onScrollUp,ai.currentPageIndex);}}};var j=function(){if(ai.goDirectlyTo>=0){Y(ai.goDirectlyTo+1,ai.desiredYOffset,ai.desiredXOffset);U(ai.goDirectlyTo);ai.goDirectlyTo=-1;return true;}return false;};var aj=function(){if(j()){return;}var at,ar,aq,ao;var ap=(ai.dimBeforeZoom>0)?ai.dimAfterZoom/ai.dimBeforeZoom:1;if(ai.doubleClick){at=ai.centerX*ap;ar=ai.centerY*ap;aq=Math.max((at)-(ai.panelWidth/2),0);ao=Math.max((ar)-(ai.panelHeight/2),0);}else{aq=ai.maxWidth/2-ai.panelWidth/2+ai.horizontalPadding;ao=ai.verticalOffset*ap;}ai.prevVptTop=0;a(ai.outerSelector).scrollTop(ao);a(ai.outerSelector).scrollLeft(aq);};var i=function(ap,ao){a.ajax({url:ai.backendServer+="&z="+ap,cache:true,context:this,dataType:"json",success:function(aq){ai.pages=aq.pgs;ai.maxWidth=aq.dims.max_w;ai.maxHeight=aq.dims.max_h;if(ai.firstAjaxRequest){o(aq,ap);}c();a.executeCallback(ao,aq);ai.firstAjaxRequest=false;}});};var o=function(ar,at){ai.itemTitle=ar.item_title;ai.numPages=ar.pgs.length;ai.maxZoomLevel=(ai.maxZoomLevel>0&&ai.maxZoomLevel<=ar.max_zoom)?ai.maxZoomLevel:ar.max_zoom;if(at>ai.maxZoomLevel){at=0;}a(ai.selector+"current label").text(ai.numPages);a(ai.selector+"goto-page-fullscreen input").attr("placeholder",ai.numPages);if(ai.enableAutoTitle){a(ai.elementSelector).prepend('<div id="'+ai.ID+'title">'+ai.itemTitle+"</div>");}var aq=parseInt(a.getHashParam("p"+ai.hashParamSuffix),10);if(!ai.enableFilename&&X(aq)){ai.goDirectlyTo=aq;}var ap=a.getHashParam("i"+ai.hashParamSuffix);var ao=m(ap);if(ai.enableFilename&&ao>=0){ai.goDirectlyTo=ao;}};var R=function(ao){if(a(ai.selector+"row-"+ao).length>0){return true;}else{return false;}};var ab=function(aq){var ap=ai.rowHeight*aq;var ao=ap+ai.rowHeight+ai.fixedPadding;return S(ap,ao);};var k=function(aw){if(R(aw)){return;}var av;var ao=(ai.rowHeight)*aw+ai.fixedPadding;var aq=[];aq.push('<div id="'+ai.ID+"row-"+aw+'" style="width: 100%; height: '+ai.rowHeight+"; position: absolute; top: "+ao+'px;">');for(av=0;av<ai.pagesPerRow;av++){var at=aw*ai.pagesPerRow+av;if(!X(at)){break;}var ax=at+1;var ap=ai.pages[at].fn;var ar=av*(ai.fixedPadding+ai.gridPageWidth)+ai.fixedPadding;var ay=parseInt(ai.gridPageWidth,10);var au=parseInt(ay/ai.pages[at].w*ai.pages[at].h,10);var az=ai.iipServerBaseUrl+ap+"&amp;WID="+(ay+1)+"&amp;CVT=JPG";aq.push('<div id="'+ai.ID+"page-"+at+'" class="diva-page" style="width: '+ay+"px; height: "+au+"px; left: "+ar+'px; display: inline;"><div style="position: absolute; background-image: url(\''+az+"'); background-repeat: no-repeat; width: "+ay+"px; height: "+au+'px;"></div></div>');}a(ai.innerSelector).append(aq.join(""));};var f=function(){i(0,function(aq){if(ai.enableGridSlider){G();}var ar=ai.fixedPadding*(ai.pagesPerRow+1);var ao=(ai.panelWidth-ar)/ai.pagesPerRow;ai.gridPageWidth=ao;ai.rowHeight=ai.fixedPadding+aq.dims.max_ratio*ao;ai.numRows=Math.ceil(ai.numPages/ai.pagesPerRow);ai.totalHeight=ai.numRows*ai.rowHeight+ai.fixedPadding;a(ai.innerSelector).css("height",Math.round(ai.totalHeight));a(ai.innerSelector).css("width",Math.round(ai.panelWidth));if(!j()){Y(ai.currentPageIndex+1);}ai.scrollSoFar=a(ai.outerSelector).scrollTop();for(var ap=0;ap<ai.numPages;ap+=ai.pagesPerRow){var at=Math.floor(ap/ai.pagesPerRow);if(ab(at)){ai.firstRowLoaded=(ai.firstRowLoaded<0)?at:ai.firstRowLoaded;k(at);ai.lastRowLoaded=at;}}});};var c=function(){a(ai.outerSelector).scrollTop(0);ai.scrollSoFar=0;a(ai.innerSelector).text("");ai.firstPageLoaded=0;ai.firstRowLoaded=-1;};var an=function(ao){i(ao,function(at){if(ao>at.max_zoom){ao=0;}if(ai.adaptivePadding>0){ai.horizontalPadding=at.dims.a_wid*ai.adaptivePadding;ai.verticalPadding=at.dims.a_hei*ai.adaptivePadding;}else{ai.horizontalPadding=ai.fixedPadding;ai.verticalPadding=ai.fixedPadding;}ai.totalHeight=at.dims.t_hei+ai.verticalPadding*(ai.numPages+1);ai.zoomLevel=ao;ai.dimAfterZoom=ai.totalHeight;if(ai.enableZoomSlider){Q();}var ap=0;for(var aq=0;aq<ai.numPages;aq++){ai.heightAbovePages[aq]=ap;ap=ai.heightAbovePages[aq]+ai.pages[aq].h+ai.verticalPadding;if(ad(aq)){w(aq);ai.lastPageLoaded=aq;}}a(ai.innerSelector).css("height",Math.round(ai.totalHeight));var ar=(at.dims.max_w+ai.horizontalPadding*2<ai.panelWidth)?ai.panelWidth:at.dims.max_w+ai.horizontalPadding*2;a(ai.innerSelector).css("width",Math.round(ar));aj();if(!ai.firstAjaxRequest){if(ai.dimBeforeZoom!==ai.dimAfterZoom){a.executeCallback(ai.onZoom,ao);if(ai.dimBeforeZoom>ai.dimAfterZoom){a.executeCallback(ai.onZoomOut,ao);a.executeCallback(ai.zoomOutCallback,ao);ai.zoomOutCallback=null;}else{a.executeCallback(ai.onZoomIn,ao);a.executeCallback(ai.zoomInCallback,ao);ai.zoomInCallback=null;}}else{a.executeCallback(ai.onFullscreen,ao);}}else{a.executeCallback(ai.onReady);}ai.dimBeforeZoom=ai.dimAfterZoom;if(ai.scaleWait){ai.scaleWait=false;}});};var ae=function(){ai.scrollSoFar=a(ai.outerSelector).scrollTop();y(ai.scrollSoFar-ai.prevVptTop);ai.prevVptTop=ai.scrollSoFar;};var am=function(){ai.scrollSoFar=a(ai.outerSelector).scrollTop();P(ai.scrollSoFar-ai.prevVptTop);ai.prevVptTop=ai.scrollSoFar;};var H=function(ao){if(ai.zoomLevel!=ao&&ao>=ai.minZoomLevel&&ao<=ai.maxZoomLevel){an(ao);a(ai.selector+"zoom-slider").slider({value:ao});return true;}else{a.executeCallback(ai.zoomInCallback,ai.zoomLevel);a.executeCallback(ai.zoomOutCallback,ai.zoomLevel);ai.zoomOutCallback=null;ai.zoomInCallback=null;return false;}};var ac=function(ao){ai.verticalOffset=a(ai.outerSelector).scrollTop();ai.horizontalOffset=a(ai.outerSelector).scrollLeft();if(ai.inGrid){e(true);}ai.doubleClick=false;H(ao);};var Y=function(ao,ap,aq){if(!ap){var ap=1;}if(!aq){var aq=0;}if(ai.inGrid){var au=Math.ceil(ao/ai.pagesPerRow)-1;if(p(au)){var at=au*ai.rowHeight;a(ai.outerSelector).scrollTop(at);U(ao-1);ai.currentPageIndex=ao-1;return true;}}else{pageIndex=ao-1;if(X(pageIndex)){var at=ai.heightAbovePages[pageIndex]+ap;U(pageIndex);a(ai.outerSelector).scrollTop(at);var ar=(aq>0)?aq:(a(ai.innerSelector).width()-ai.panelWidth)/2;a(ai.outerSelector).scrollLeft(ar);a.executeCallback(ai.onJump,ao);return true;}}return false;};var J=function(ap){var ao;if(ai.zoomLevel===ai.maxZoomLevel){if(ap.ctrlKey){ao=ai.zoomLevel-1;}else{return;}}else{if(ai.zoomLevel===ai.minZoomLevel){if(ap.ctrlKey){return;}else{ao=ai.zoomLevel+1;}}else{if(ap.ctrlKey){ao=ai.zoomLevel-1;}else{ao=ai.zoomLevel+1;}}}ai.centerX=(ap.pageX-ai.viewerXOffset)+a(ai.outerSelector).scrollLeft();ai.centerY=(ap.pageY-ai.viewerYOffset)+a(ai.outerSelector).scrollTop();ai.doubleClick=true;H(ao);};var C=function(ao){ao.preventDefault();};var K=function(ap){var ao=ai.zoomLevel;if(ap.scale>1&&ao<ai.maxZoomLevel){ao++;}else{if(ap.scale<1&&ao>ai.minZoomLevel){ao--;}else{return;}}ai.scaleWait=true;ac(ao);};var t=function(){ai.verticalOffset=a(ai.outerSelector).scrollTop();ai.horizontalOffset=a(ai.outerSelector).scrollLeft();ai.doubleClick=false;a(ai.innerSelector).text("");if(ai.inFullscreen){W();}else{ag();}ai.panelWidth=parseInt(a(ai.outerSelector).width(),10)-20;ai.panelHeight=parseInt(a(ai.outerSelector).height(),10);a(ai.innerSelector).width(ai.panelWidth);if(ai.inGrid){f();}else{an(ai.zoomLevel);}};var ag=function(){if(ai.fullscreenStatusbar==null){h("none");}a(ai.selector+"fullscreen").css("position","fixed").css("z-index","9001");a(ai.outerSelector).addClass("fullscreen");ai.inFullscreen=true;a("body").css("overflow","hidden");a.executeCallback(ai.onFullscreenEnter);};var W=function(){if(ai.fullscreenStatusbar!=null){ai.fullscreenStatusbar.pnotify({pnotify_animation:"none"});ai.fullscreenStatusbar.pnotify_remove();ai.fullscreenStatusbar=null;}a(ai.outerSelector).removeClass("fullscreen");ai.inFullscreen=false;a(ai.selector+"fullscreen").css("position","absolute").css("z-index","8999");a.executeCallback(ai.onFullscreenExit);};var x=function(){if(ai.inGrid){e();}else{B();}};var B=function(){ai.desiredXOffset=al();ai.desiredYOffset=ak();ai.inGrid=true;f();};var e=function(ao){ai.inGrid=false;if(ai.goDirectlyTo<0){ai.goDirectlyTo=ai.currentPageIndex;}if(!ao){an(ai.zoomLevel);}};var E=function(){if(ai.enableGrid){a(ai.selector+"grid-icon").click(function(){x();});}if(ai.enableFullscreen){a(ai.selector+"fullscreen").click(function(){t();});var ap;a(window).resize(function(){clearTimeout(ap);ap=setTimeout(function(){ai.panelHeight=parseInt(a(ai.outerSelector).height(),10);y(1);var au=a("body").css("width");a(ai.innerSelector).css("width",au);},10);});}a(ai.innerSelector).mouseover(function(){a(this).removeClass("grabbing").addClass("grab");});a(ai.innerSelector).mouseout(function(){a(this).removeClass("grab");});a(ai.innerSelector).mousedown(function(){a(this).removeClass("grab").addClass("grabbing");});a(ai.innerSelector).mouseup(function(){a(this).removeClass("grabbing").addClass("grab");});a(ai.outerSelector+", "+ai.innerSelector).dragscrollable({dragSelector:".dragger",acceptPropagatedEvent:true});a(ai.outerSelector).scroll(function(){if(ai.inGrid){am();}else{ae();}});a(ai.outerSelector).dblclick(function(aw){ai.viewerXOffset=this.offsetLeft;ai.viewerYOffset=this.offsetTop;if(ai.inGrid){var ay=(aw.pageX-ai.viewerXOffset)+a(ai.outerSelector).scrollLeft();var ax=(aw.pageY-ai.viewerYOffset)+a(ai.outerSelector).scrollTop();var az=Math.floor(ax/ai.rowHeight);var av=Math.floor(ay/(ai.panelWidth/ai.pagesPerRow));var au=az*ai.pagesPerRow+av;ai.desiredXOffset=0;ai.desiredYOffset=0;ai.goDirectlyTo=au;e();}else{J(aw);}});a(ai.outerSelector).bind("contextmenu",function(au){var av=au.originalEvent;if(av.ctrlKey){av.preventDefault();av.stopPropagation();}});if(ai.mobileSafari){a(ai.outerSelector).oneFingerScroll();var aq=[];aq.push('<meta name="viewport" content="user-scalable=no, width=device-width" />');aq.push('<meta name="apple-mobile-web-app-capable" content="yes" />');aq.push('<meta name="apple-mobile-web-app-status-bar-style" content="black" />');a("head").append(aq.join("\n"));a("body").bind("touchmove",function(au){var av=au.originalEvent;C(av);});a("body").bind("gestureend",function(au){var av=au.originalEvent;if(!ai.scaleWait){if(ai.inGrid){e();}else{K(av);}}return false;});}if(ai.enableSpaceScroll||ai.enableKeyScroll){var ar=a.ui.keyCode.SPACE;var ao=a.ui.keyCode.PAGE_UP;var at=a.ui.keyCode.PAGE_DOWN;a(document).keydown(function(au){if((ai.enableSpaceScroll&&au.keyCode==ar)||(ai.enableKeyScroll&&au.keyCode==at)){a(ai.outerSelector).scrollTop(ai.scrollSoFar+ai.panelHeight);return false;}if(ai.enableKeyScroll&&au.keyCode==ao){a(ai.outerSelector).scrollTop(ai.scrollSoFar-ai.panelHeight);return false;}});}};var h=function(aq){var ao=(ai.enableGrid)?'<div id="'+ai.ID+'grid-icon-fullscreen"></div>':"";var ap={pnotify_text:'<form id="'+ai.ID+'goto-page-fullscreen"><input placeholder="'+ai.numPages+'" type="text" size="4" id="'+ai.ID+'goto-input-fullscreen" /><input type="submit" value="Go"></form><div id="'+ai.ID+'tools-fullscreen" style="height: 60px;"></div><div id="'+ai.ID+'link-fullscreen"><a href="">Link</a></div>',pnotify_title:ao+'Page: <span id="'+ai.ID+'page-number-fullscreen">'+(ai.currentPageIndex+1)+"</span>",pnotify_history:false,pnotify_width:"160px",pnotify_hide:false,pnotify_notice_icon:"",pnotify_animation:aq,pnotify_before_close:function(){ai.fullscreenStatusbar=null;}};ai.fullscreenStatusbar=a.pnotify(ap);a(ai.selector+"link-fullscreen a").click(function(){a("body").prepend('<div id="'+ai.ID+'link-popup-fullscreen"><input id="'+ai.ID+'link-popup-input-fullscreen" class="diva-input" value="'+A()+'" /></div>');var ar=a("div.ui-pnotify").offset();a(ai.selector+"link-popup-fullscreen").css("left",ar.left+"px").css("top",(ar.top+a("div.ui-pnotify").height()+5)+"px");a("body").mouseup(function(au){var at=au.target.id;if(at!==ai.ID+"link-popup-fullscreen"&&at!==ai.ID+"link-popup-input-fullscreen"){a(ai.selector+"link-popup-fullscreen").remove();}});a(ai.outerSelector).scroll(function(){a(ai.selector+"link-popup-fullscreen").remove();});return false;});a(ai.selector+"grid-icon-fullscreen").click(function(){x();});if(ai.inGrid&&ai.enableGridSlider){G();}else{if(ai.enableZoomSlider){Q();}}a(ai.selector+"goto-page-fullscreen").submit(function(){var ar=parseInt(a(ai.selector+"goto-input-fullscreen").val(),10);if(!Y(ar)){alert("Invalid page number");}return false;});};var Q=function(){a(ai.selector+"slider").remove();a(ai.selector+"slider-label").remove();var ao=(ai.inFullscreen)?"tools-fullscreen":"tools";a(ai.selector+ao).prepend('<div id="'+ai.ID+'slider"></div>');a(ai.selector+"slider").slider({value:ai.zoomLevel,min:ai.minZoomLevel,max:ai.maxZoomLevel,step:1,slide:function(ap,aq){ac(aq.value);}});a(ai.selector+"slider").after('<div id="'+ai.ID+'slider-label">Zoom level: <span>'+ai.zoomLevel+"</span></div>");};var G=function(){a(ai.selector+"slider").remove();a(ai.selector+"slider-label").remove();var ao=(ai.inFullscreen)?"tools-fullscreen":"tools";a(ai.selector+ao).prepend('<div id="'+ai.ID+'slider"></div>');a(ai.selector+"slider").slider({value:ai.pagesPerRow,min:ai.minPagesPerRow,max:ai.maxPagesPerRow,step:1,slide:function(ap,aq){s(aq.value);}});a(ai.selector+"slider").after('<div id="'+ai.ID+'slider-label">Pages per row: <span>'+ai.pagesPerRow+"</span></div>");};var s=function(ao){ai.pagesPerRow=ao;B();};var aa=function(){a(ai.selector+"tools").prepend('<div id="'+ai.ID+'grid-icon"></div>');};var q=function(){a(ai.selector+"tools").append('<form id="'+ai.ID+'goto-page">Go to page <input type="text" size="3" id="'+ai.ID+'goto-input" /> <input type="submit" value="Go" /><br /><div id="'+ai.ID+'current">Current page: <span>1</span> of <label></label> <a href="" id="'+ai.ID+'link">(link)</a></div></form>');a(ai.selector+"link").click(function(){var ao=a(ai.outerSelector).offset().left+ai.panelWidth;a("body").prepend('<div id="'+ai.ID+'link-popup"><input id="'+ai.ID+'link-popup-input" class="diva-input" type="text" value="'+A()+'"/></div>');a(ai.selector+"link-popup").css("top",a(ai.outerSelector).offset().top+"px").css("left",(ao-298)+"px");a("body").mouseup(function(aq){var ap=aq.target.id;if(ap==ai.ID+"link-popup"||ap==ai.ID+"link-popup-input"){}else{a(ai.selector+"link-popup").remove();}});a(ai.outerSelector).scroll(function(){a(ai.selector+"link-popup").remove();});return false;});a(ai.selector+"goto-page").submit(function(){var ao=parseInt(a(ai.selector+"goto-input").val(),10);if(!Y(ao)){alert("Invalid page number");}return false;});};var m=function(ao){for(var ap=0;ap<ai.numPages;ap++){if(ai.pages[ap].fn==ao){return ap;}}return -1;};var ak=function(){var ao=a(ai.outerSelector).scrollTop();var ap=ai.heightAbovePages[ai.currentPageIndex];return ao-ap;};var al=function(){return a(ai.outerSelector).scrollLeft();};var A=function(ar){var at=parseInt(ak(),10);var ap=parseInt(al(),10);var ao={f:(ai.inFullscreen)?"1":"",g:(ai.inGrid)?"1":"",z:(!ai.inGrid)?ai.zoomLevel:"",n:(ai.inGrid)?ai.pagesPerRow:"",i:(ai.enableFilename)?ai.pages[ai.currentPageIndex].fn:"",p:(!ai.enableFilename)?ai.currentPageIndex+1:"",y:(at>0&&!ai.inGrid)?at:"",x:(ap>0&&!ai.inGrid)?ap:""};var aq=[];for(param in ao){if(ao[param]!==""){aq.push(param+ai.hashParamSuffix+"="+ao[param]);}}if(ar){return aq.join("&");}else{return location.host+location.pathname+"#"+aq.join("&");}};var ah=function(){ai.mobileSafari=navigator.platform=="iPad"||navigator.platform=="iPhone"||navigator.platform=="iPod";ai.elementSelector="#"+a(r).attr("id");ai.ID=a.generateId("diva-");ai.selector="#"+ai.ID;var aq=parseInt(ai.ID,10);if(aq>1){ai.hashParamSuffix=aq;}ai.outerSelector=ai.selector+"outer";ai.innerSelector=ai.selector+"inner";if(ai.zoomSlider||ai.enableGotoPage||ai.enableGrid){a(ai.elementSelector).prepend('<div id="'+ai.ID+'tools"></div>');}if(ai.enableGotoPage){q();}if(ai.enableGrid){aa();}a(ai.elementSelector).append('<div id="'+ai.ID+'outer"></div>');a(ai.outerSelector).append('<div id="'+ai.ID+'inner" class="dragger"></div>');if(ai.mobileSafari){ai.panelWidth=screen.width-20;if(navigator.platform=="iPad"){ai.panelHeight=screen.height-170;}else{ai.panelHeight=screen.height-250;}a(ai.elementSelector).css("width",ai.panelWidth);a(ai.outerSelector).css("width",ai.panelWidth+"px");a(ai.outerSelector).css("height",ai.panelHeight+"px");}else{ai.panelWidth=parseInt(a(ai.elementSelector).width(),10)-18;a(ai.outerSelector).css("width",(ai.panelWidth+18)+"px");ai.panelHeight=parseInt(a(ai.outerSelector).height(),10);}if(ai.enableFullscreen){a(ai.elementSelector).prepend('<div id="'+ai.ID+'fullscreen"></div>');}var au=parseInt(a.getHashParam("n"+ai.hashParamSuffix),10);if(au>=ai.minPagesPerRow&&au<=ai.maxPagesPerRow){ai.pagesPerRow=au;}var ar=a.getHashParam("z"+ai.hashParamSuffix);if(ar!==""){ar=parseInt(ar,10);if(ar>=ai.minZoomLevel){ai.zoomLevel=ar;}}var at=parseInt(a.getHashParam("y"+ai.hashParamSuffix),10);if(at>0){ai.desiredYOffset=at;}var av=parseInt(a.getHashParam("x"+ai.hashParamSuffix),10);if(av>0){ai.desiredXOffset=av;}var ap=a.getHashParam("f"+ai.hashParamSuffix);if(ap==="1"&&ai.enableFullscreen){t();}var ao=a.getHashParam("g"+ai.hashParamSuffix);if(ao==="1"&&ai.enableGrid){x();}if(!ai.inFullscreen&&!ai.inGrid){an(ai.zoomLevel);}E();};ah();this.getItemTitle=function(){return ai.itemTitle;};this.gotoPage=function(ao){return Y(ao);};this.getCurrentPage=function(){return ai.currentPageIndex;};this.getZoomLevel=function(){return ai.zoomLevel;};this.zoomIn=function(ao){ai.zoomInCallback=ao;return H(ai.zoomLevel+1);};this.zoomOut=function(ao){ai.zoomOutCallback=ao;return H(ai.zoomLevel-1);};this.inViewport=function(aq,at,ap){var ao=aq-1;var au=ai.heightAbovePages[ao]+at;var ar=au+ap;return S(au,ar);};this.gotoPageByName=function(ao){for(var ap=0;ap<ai.numPages;ap++){if(ai.pages[ap].fn==ao){Y(ap);return true;}}return false;};this.getCurrentURL=function(){return A();};this.getURLHash=function(){return A(true);};};a.fn.diva=function(c){return this.each(function(){var e=a(this);if(e.data("diva")){return;}var d=new b(this,c);e.data("diva",d);});};})(jQuery);